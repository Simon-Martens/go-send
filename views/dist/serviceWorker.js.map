{
  "version": 3,
  "sources": ["../src/utils-worker.mjs", "../src/streams.mjs", "../src/crypto/ece.mjs", "../src/keychain.mjs", "../src/api.mjs", "../node_modules/crc/mjs/calculators/crc32.js", "../src/zip.mjs", "../src/serviceWorker.mjs"],
  "sourcesContent": ["// Worker-safe utilities (no DOM dependencies)\n\n// INFO: base64 encoding/decoding\n// INFO: support for .toBase64() and .fromBase64() was added to browsers in late 24. So we use this for now.\nexport function arrayToB64(array) {\n  let bin = \"\";\n  const chunkSize = 0x8000; // 32k chars per chunk\n  for (let i = 0; i < array.length; i += chunkSize) {\n    bin += String.fromCharCode(...array.subarray(i, i + chunkSize));\n  }\n  return btoa(bin).replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+$/, \"\");\n}\n\nexport function b64ToArray(str) {\n  const b64 =\n    str.replace(/-/g, \"+\").replace(/_/g, \"/\") +\n    \"===\".slice((str.length + 3) % 4);\n  const bin = atob(b64);\n  const out = new Uint8Array(bin.length);\n  for (let i = 0; i < bin.length; i++) out[i] = bin.charCodeAt(i);\n  return out;\n}\n\n// Concatenate multiple Uint8Arrays into a single Uint8Array\nexport function concatUint8Arrays(arrays) {\n  const totalLength = arrays.reduce((sum, arr) => sum + arr.length, 0);\n  const result = new Uint8Array(totalLength);\n  let offset = 0;\n  for (const arr of arrays) {\n    result.set(arr, offset);\n    offset += arr.length;\n  }\n  return result;\n}\n\n// Read a 32-bit unsigned integer in big-endian format\nexport function readUint32BE(array, offset) {\n  const view = new DataView(array.buffer, array.byteOffset, array.byteLength);\n  return view.getUint32(offset, false); // false = big-endian\n}\n\n// Write a 32-bit unsigned integer in big-endian format\nexport function writeUint32BE(array, offset, value) {\n  const view = new DataView(array.buffer, array.byteOffset, array.byteLength);\n  view.setUint32(offset, value, false); // false = big-endian\n}\n\n// Read an 8-bit unsigned integer\nexport function readUint8(array, offset) {\n  return array[offset];\n}\n\n// Write an 8-bit unsigned integer\nexport function writeUint8(array, offset, value) {\n  array[offset] = value;\n}\n\n//////////////////// OTHER HELPERS ////////////////////\nexport function delay(delay = 100) {\n  return new Promise((resolve) => setTimeout(resolve, delay));\n}\n\nexport async function streamToArrayBuffer(stream, size) {\n  const reader = stream.getReader();\n  let state = await reader.read();\n\n  if (size) {\n    const result = new Uint8Array(size);\n    let offset = 0;\n    while (!state.done) {\n      result.set(state.value, offset);\n      offset += state.value.length;\n      state = await reader.read();\n    }\n    return result.buffer;\n  }\n\n  const parts = [];\n  let len = 0;\n  while (!state.done) {\n    parts.push(state.value);\n    len += state.value.length;\n    state = await reader.read();\n  }\n  let offset = 0;\n  const result = new Uint8Array(len);\n  for (const part of parts) {\n    result.set(part, offset);\n    offset += part.length;\n  }\n  return result.buffer;\n}\n", "/* global TransformStream */\n\nexport function transformStream(readable, transformer = {}, oncancel) {\n  const reader = readable.getReader();\n  const wrappedTransformer = transformer || {};\n\n  return new ReadableStream({\n    async start(controller) {\n      if (wrappedTransformer.start) {\n        await wrappedTransformer.start(controller);\n      }\n    },\n\n    async pull(controller) {\n      while (true) {\n        const { value, done } = await reader.read();\n\n        if (done) {\n          if (wrappedTransformer.flush) {\n            await wrappedTransformer.flush(controller);\n          }\n          reader.releaseLock();\n          controller.close();\n          return;\n        }\n\n        if (!wrappedTransformer.transform) {\n          controller.enqueue(value);\n          return;\n        }\n\n        let enqueued = false;\n        const wrappedController = {\n          enqueue(chunk) {\n            enqueued = true;\n            controller.enqueue(chunk);\n          }\n        };\n\n        await wrappedTransformer.transform(value, wrappedController);\n\n        if (enqueued) {\n          return;\n        }\n        // If nothing was enqueued, loop to read the next chunk.\n      }\n    },\n\n    cancel(reason) {\n      reader.cancel(reason);\n      if (wrappedTransformer.cancel) {\n        wrappedTransformer.cancel(reason);\n      }\n      if (oncancel) {\n        oncancel(reason);\n      }\n    }\n  });\n}\n\nclass BlobStreamController {\n  constructor(blob, size) {\n    this.blob = blob;\n    this.index = 0;\n    this.chunkSize = size || 1024 * 64;\n  }\n\n  pull(controller) {\n    return new Promise((resolve, reject) => {\n      const bytesLeft = this.blob.size - this.index;\n      if (bytesLeft <= 0) {\n        controller.close();\n        return resolve();\n      }\n      const size = Math.min(this.chunkSize, bytesLeft);\n      const slice = this.blob.slice(this.index, this.index + size);\n      const reader = new FileReader();\n      reader.onload = () => {\n        controller.enqueue(new Uint8Array(reader.result));\n        resolve();\n      };\n      reader.onerror = reject;\n      reader.readAsArrayBuffer(slice);\n      this.index += size;\n    });\n  }\n}\n\nexport function blobStream(blob, size) {\n  return new ReadableStream(new BlobStreamController(blob, size));\n}\n\nclass ConcatStreamController {\n  constructor(streams) {\n    this.streams = streams;\n    this.index = 0;\n    this.reader = null;\n    this.nextReader();\n  }\n\n  nextReader() {\n    const next = this.streams[this.index++];\n    this.reader = next && next.getReader();\n  }\n\n  async pull(controller) {\n    if (!this.reader) {\n      return controller.close();\n    }\n    const data = await this.reader.read();\n    if (data.done) {\n      this.nextReader();\n      return this.pull(controller);\n    }\n    controller.enqueue(data.value);\n  }\n}\n\nexport function concatStream(streams) {\n  return new ReadableStream(new ConcatStreamController(streams));\n}\n", "import { transformStream } from \"../streams\";\nimport {\n  concatUint8Arrays,\n  readUint32BE,\n  writeUint32BE,\n  readUint8,\n  writeUint8,\n} from \"../utils-worker.mjs\";\n\nconst NONCE_LENGTH = 12;\nconst TAG_LENGTH = 16;\nconst KEY_LENGTH = 16;\nconst MODE_ENCRYPT = \"encrypt\";\nconst MODE_DECRYPT = \"decrypt\";\nexport const ECE_RECORD_SIZE = 1024 * 64;\n\nconst encoder = new TextEncoder();\n\nfunction generateSalt(len) {\n  const randSalt = new Uint8Array(len);\n  crypto.getRandomValues(randSalt);\n  return randSalt.buffer;\n}\n\nclass ECETransformer {\n  constructor(mode, ikm, rs, salt) {\n    this.mode = mode;\n    this.prevChunk;\n    this.seq = 0;\n    this.firstchunk = true;\n    this.rs = rs;\n    this.ikm = ikm.buffer;\n    this.salt = salt;\n  }\n\n  async generateKey() {\n    const inputKey = await crypto.subtle.importKey(\n      \"raw\",\n      this.ikm,\n      \"HKDF\",\n      false,\n      [\"deriveKey\"],\n    );\n\n    return crypto.subtle.deriveKey(\n      {\n        name: \"HKDF\",\n        salt: this.salt,\n        info: encoder.encode(\"Content-Encoding: aes128gcm\\0\"),\n        hash: \"SHA-256\",\n      },\n      inputKey,\n      {\n        name: \"AES-GCM\",\n        length: 128,\n      },\n      true, // Edge polyfill requires key to be extractable to encrypt :/\n      [\"encrypt\", \"decrypt\"],\n    );\n  }\n\n  async generateNonceBase() {\n    const inputKey = await crypto.subtle.importKey(\n      \"raw\",\n      this.ikm,\n      \"HKDF\",\n      false,\n      [\"deriveKey\"],\n    );\n\n    const base = await crypto.subtle.exportKey(\n      \"raw\",\n      await crypto.subtle.deriveKey(\n        {\n          name: \"HKDF\",\n          salt: this.salt,\n          info: encoder.encode(\"Content-Encoding: nonce\\0\"),\n          hash: \"SHA-256\",\n        },\n        inputKey,\n        {\n          name: \"AES-GCM\",\n          length: 128,\n        },\n        true,\n        [\"encrypt\", \"decrypt\"],\n      ),\n    );\n\n    return new Uint8Array(base.slice(0, NONCE_LENGTH));\n  }\n\n  generateNonce(seq) {\n    if (seq > 0xffffffff) {\n      throw new Error(\"record sequence number exceeds limit\");\n    }\n    const nonce = new Uint8Array(this.nonceBase);\n    const m = readUint32BE(nonce, nonce.length - 4);\n    const xor = (m ^ seq) >>> 0; //forces unsigned int xor\n    writeUint32BE(nonce, nonce.length - 4, xor);\n\n    return nonce;\n  }\n\n  pad(data, isLast) {\n    const len = data.length;\n    if (len + TAG_LENGTH >= this.rs) {\n      throw new Error(\"data too large for record size\");\n    }\n\n    if (isLast) {\n      const padding = new Uint8Array(1);\n      padding[0] = 2;\n      return concatUint8Arrays([data, padding]);\n    } else {\n      const padding = new Uint8Array(this.rs - len - TAG_LENGTH);\n      // Uint8Array is already zero-filled, no need for .fill(0)\n      padding[0] = 1;\n      return concatUint8Arrays([data, padding]);\n    }\n  }\n\n  unpad(data, isLast) {\n    for (let i = data.length - 1; i >= 0; i--) {\n      if (data[i]) {\n        if (isLast) {\n          if (data[i] !== 2) {\n            throw new Error(\"delimiter of final record is not 2\");\n          }\n        } else {\n          if (data[i] !== 1) {\n            throw new Error(\"delimiter of not final record is not 1\");\n          }\n        }\n        return data.slice(0, i);\n      }\n    }\n    throw new Error(\"no delimiter found\");\n  }\n\n  createHeader() {\n    const nums = new Uint8Array(5);\n    writeUint32BE(nums, 0, this.rs);\n    writeUint8(nums, 4, 0);\n    return concatUint8Arrays([new Uint8Array(this.salt), nums]);\n  }\n\n  readHeader(buffer) {\n    if (buffer.length < 21) {\n      throw new Error(\"chunk too small for reading header\");\n    }\n    const header = {};\n    header.salt = buffer.buffer.slice(0, KEY_LENGTH);\n    header.rs = readUint32BE(buffer, KEY_LENGTH);\n    const idlen = readUint8(buffer, KEY_LENGTH + 4);\n    header.length = idlen + KEY_LENGTH + 5;\n    return header;\n  }\n\n  async encryptRecord(buffer, seq, isLast) {\n    const nonce = this.generateNonce(seq);\n    const encrypted = await crypto.subtle.encrypt(\n      { name: \"AES-GCM\", iv: nonce },\n      this.key,\n      this.pad(buffer, isLast),\n    );\n    return new Uint8Array(encrypted);\n  }\n\n  async decryptRecord(buffer, seq, isLast) {\n    const nonce = this.generateNonce(seq);\n    const data = await crypto.subtle.decrypt(\n      {\n        name: \"AES-GCM\",\n        iv: nonce,\n        tagLength: 128,\n      },\n      this.key,\n      buffer,\n    );\n\n    return this.unpad(new Uint8Array(data), isLast);\n  }\n\n  async start(controller) {\n    if (this.mode === MODE_ENCRYPT) {\n      this.key = await this.generateKey();\n      this.nonceBase = await this.generateNonceBase();\n      controller.enqueue(this.createHeader());\n    } else if (this.mode !== MODE_DECRYPT) {\n      throw new Error(\"mode must be either encrypt or decrypt\");\n    }\n  }\n\n  async transformPrevChunk(isLast, controller) {\n    if (this.mode === MODE_ENCRYPT) {\n      controller.enqueue(\n        await this.encryptRecord(this.prevChunk, this.seq, isLast),\n      );\n      this.seq++;\n    } else {\n      if (this.seq === 0) {\n        //the first chunk during decryption contains only the header\n        const header = this.readHeader(this.prevChunk);\n        this.salt = header.salt;\n        this.rs = header.rs;\n        this.key = await this.generateKey();\n        this.nonceBase = await this.generateNonceBase();\n      } else {\n        controller.enqueue(\n          await this.decryptRecord(this.prevChunk, this.seq - 1, isLast),\n        );\n      }\n      this.seq++;\n    }\n  }\n\n  async transform(chunk, controller) {\n    if (!this.firstchunk) {\n      await this.transformPrevChunk(false, controller);\n    }\n    this.firstchunk = false;\n    this.prevChunk = new Uint8Array(chunk.buffer);\n  }\n\n  async flush(controller) {\n    //console.log('ece stream ends')\n    if (this.prevChunk) {\n      await this.transformPrevChunk(true, controller);\n    }\n  }\n}\n\nclass StreamSlicer {\n  constructor(rs, mode) {\n    this.mode = mode;\n    this.rs = rs;\n    this.chunkSize = mode === MODE_ENCRYPT ? rs - 17 : 21;\n    this.partialChunk = new Uint8Array(this.chunkSize); //where partial chunks are saved\n    this.offset = 0;\n  }\n\n  send(buf, controller) {\n    controller.enqueue(buf);\n    if (this.chunkSize === 21 && this.mode === MODE_DECRYPT) {\n      this.chunkSize = this.rs;\n    }\n    this.partialChunk = new Uint8Array(this.chunkSize);\n    this.offset = 0;\n  }\n\n  //reslice input into record sized chunks\n  transform(chunk, controller) {\n    //console.log('Received chunk with %d bytes.', chunk.byteLength)\n    let i = 0;\n\n    if (this.offset > 0) {\n      const len = Math.min(chunk.byteLength, this.chunkSize - this.offset);\n      this.partialChunk.set(chunk.slice(0, len), this.offset);\n      this.offset += len;\n      i += len;\n\n      if (this.offset === this.chunkSize) {\n        this.send(this.partialChunk, controller);\n      }\n    }\n\n    while (i < chunk.byteLength) {\n      const remainingBytes = chunk.byteLength - i;\n      if (remainingBytes >= this.chunkSize) {\n        const record = chunk.slice(i, i + this.chunkSize);\n        i += this.chunkSize;\n        this.send(record, controller);\n      } else {\n        const end = chunk.slice(i, i + remainingBytes);\n        i += end.byteLength;\n        this.partialChunk.set(end);\n        this.offset = end.byteLength;\n      }\n    }\n  }\n\n  flush(controller) {\n    if (this.offset > 0) {\n      controller.enqueue(this.partialChunk.slice(0, this.offset));\n    }\n  }\n}\n\n/*\ninput: a ReadableStream containing data to be transformed\nkey:  Uint8Array containing key of size KEY_LENGTH\nrs:   int containing record size, optional\nsalt: ArrayBuffer containing salt of KEY_LENGTH length, optional\n*/\nexport function encryptStream(\n  input,\n  key,\n  rs = ECE_RECORD_SIZE,\n  salt = generateSalt(KEY_LENGTH),\n) {\n  const mode = \"encrypt\";\n  const inputStream = transformStream(input, new StreamSlicer(rs, mode));\n  return transformStream(inputStream, new ECETransformer(mode, key, rs, salt));\n}\n\n/*\ninput: a ReadableStream containing data to be transformed\nkey:  Uint8Array containing key of size KEY_LENGTH\nrs:   int containing record size, optional\n*/\nexport function decryptStream(input, key, rs = ECE_RECORD_SIZE) {\n  const mode = \"decrypt\";\n  const inputStream = transformStream(input, new StreamSlicer(rs, mode));\n  return transformStream(inputStream, new ECETransformer(mode, key, rs));\n}\n", "import { arrayToB64, b64ToArray } from \"./utils-worker.mjs\";\nimport { decryptStream, encryptStream } from \"./crypto/ece.mjs\";\nconst encoder = new TextEncoder();\nconst decoder = new TextDecoder();\n\nexport default class Keychain {\n  constructor(secretKeyB64, nonce) {\n    this._nonce = nonce || \"yRCdyQ1EMSA3mo4rqSkuNQ==\";\n    if (secretKeyB64) {\n      this.rawSecret = b64ToArray(secretKeyB64);\n    } else {\n      this.rawSecret = crypto.getRandomValues(new Uint8Array(16));\n    }\n    this.secretKeyPromise = crypto.subtle.importKey(\n      \"raw\",\n      this.rawSecret,\n      \"HKDF\",\n      false,\n      [\"deriveKey\"],\n    );\n    this.metaKeyPromise = this.secretKeyPromise.then(function (secretKey) {\n      return crypto.subtle.deriveKey(\n        {\n          name: \"HKDF\",\n          salt: new Uint8Array(),\n          info: encoder.encode(\"metadata\"),\n          hash: \"SHA-256\",\n        },\n        secretKey,\n        {\n          name: \"AES-GCM\",\n          length: 128,\n        },\n        false,\n        [\"encrypt\", \"decrypt\"],\n      );\n    });\n    this.authKeyPromise = this.secretKeyPromise.then(function (secretKey) {\n      return crypto.subtle.deriveKey(\n        {\n          name: \"HKDF\",\n          salt: new Uint8Array(),\n          info: encoder.encode(\"authentication\"),\n          hash: \"SHA-256\",\n        },\n        secretKey,\n        {\n          name: \"HMAC\",\n          hash: { name: \"SHA-256\" },\n        },\n        true,\n        [\"sign\"],\n      );\n    });\n  }\n\n  get nonce() {\n    return this._nonce;\n  }\n\n  set nonce(n) {\n    if (n && n !== this._nonce) {\n      this._nonce = n;\n    }\n  }\n\n  setPassword(password, shareUrl) {\n    this.authKeyPromise = crypto.subtle\n      .importKey(\"raw\", encoder.encode(password), { name: \"PBKDF2\" }, false, [\n        \"deriveKey\",\n      ])\n      .then((passwordKey) =>\n        crypto.subtle.deriveKey(\n          {\n            name: \"PBKDF2\",\n            salt: encoder.encode(shareUrl),\n            iterations: 100,\n            hash: \"SHA-256\",\n          },\n          passwordKey,\n          {\n            name: \"HMAC\",\n            hash: \"SHA-256\",\n          },\n          true,\n          [\"sign\"],\n        ),\n      );\n  }\n\n  setAuthKey(authKeyB64) {\n    this.authKeyPromise = crypto.subtle.importKey(\n      \"raw\",\n      b64ToArray(authKeyB64),\n      {\n        name: \"HMAC\",\n        hash: \"SHA-256\",\n      },\n      true,\n      [\"sign\"],\n    );\n  }\n\n  async authKeyB64() {\n    const authKey = await this.authKeyPromise;\n    const rawAuth = await crypto.subtle.exportKey(\"raw\", authKey);\n    return arrayToB64(new Uint8Array(rawAuth));\n  }\n\n  async authHeader() {\n    const authKey = await this.authKeyPromise;\n    const sig = await crypto.subtle.sign(\n      {\n        name: \"HMAC\",\n      },\n      authKey,\n      b64ToArray(this.nonce),\n    );\n    return `send-v1 ${arrayToB64(new Uint8Array(sig))}`;\n  }\n\n  async encryptMetadata(metadata) {\n    const metaKey = await this.metaKeyPromise;\n    const ciphertext = await crypto.subtle.encrypt(\n      {\n        name: \"AES-GCM\",\n        iv: new Uint8Array(12),\n        tagLength: 128,\n      },\n      metaKey,\n      encoder.encode(\n        JSON.stringify({\n          name: metadata.name,\n          size: metadata.size,\n          type: metadata.type || \"application/octet-stream\",\n          manifest: metadata.manifest || {},\n        }),\n      ),\n    );\n    return ciphertext;\n  }\n\n  encryptStream(plainStream) {\n    return encryptStream(plainStream, this.rawSecret);\n  }\n\n  decryptStream(cryptotext) {\n    return decryptStream(cryptotext, this.rawSecret);\n  }\n\n  async decryptMetadata(ciphertext) {\n    const metaKey = await this.metaKeyPromise;\n    const plaintext = await crypto.subtle.decrypt(\n      {\n        name: \"AES-GCM\",\n        iv: new Uint8Array(12),\n        tagLength: 128,\n      },\n      metaKey,\n      ciphertext,\n    );\n    return JSON.parse(decoder.decode(plaintext));\n  }\n}\n", "import { arrayToB64, b64ToArray, delay } from \"./utils-worker\";\nimport { ECE_RECORD_SIZE } from \"./crypto/ece.mjs\";\n\nlet fileProtocolWssUrl = null;\n\ntry {\n  fileProtocolWssUrl = localStorage.getItem(\"wssURL\");\n} catch (e) {\n  // NOOP\n}\n\nif (!fileProtocolWssUrl) {\n  fileProtocolWssUrl = \"wss://send.firefox.com/api/ws\";\n}\n\nexport class ConnectionError extends Error {\n  constructor(cancelled, duration, size) {\n    super(cancelled ? \"0\" : \"connection closed\");\n    this.cancelled = cancelled;\n    this.duration = duration;\n    this.size = size;\n  }\n}\n\nexport function setFileProtocolWssUrl(url) {\n  localStorage && localStorage.setItem(\"wssURL\", url);\n  fileProtocolWssUrl = url;\n}\n\nexport function getFileProtocolWssUrl() {\n  return fileProtocolWssUrl;\n}\n\nlet apiUrlPrefix = \"\";\nexport function getApiUrl(path) {\n  return apiUrlPrefix + path;\n}\n\nexport function setApiUrlPrefix(prefix) {\n  apiUrlPrefix = prefix;\n}\n\nfunction post(obj) {\n  const h = {\n    \"Content-Type\": \"application/json\",\n  };\n  return {\n    method: \"POST\",\n    headers: new Headers(h),\n    body: JSON.stringify(obj),\n  };\n}\n\nexport function parseNonce(header) {\n  header = header || \"\";\n  return header.split(\" \")[1];\n}\n\nasync function fetchWithAuth(url, params, keychain) {\n  const result = {};\n  params = params || {};\n  const h = await keychain.authHeader();\n  params.headers = new Headers({\n    Authorization: h,\n    \"Content-Type\": \"application/json\",\n  });\n  const response = await fetch(url, params);\n  result.response = response;\n  result.ok = response.ok;\n  const nonce = parseNonce(response.headers.get(\"WWW-Authenticate\"));\n  result.shouldRetry = response.status === 401 && nonce !== keychain.nonce;\n  keychain.nonce = nonce;\n  return result;\n}\n\nasync function fetchWithAuthAndRetry(url, params, keychain) {\n  const result = await fetchWithAuth(url, params, keychain);\n  if (result.shouldRetry) {\n    return fetchWithAuth(url, params, keychain);\n  }\n  return result;\n}\n\nexport async function del(id, owner_token) {\n  const response = await fetch(\n    getApiUrl(`/api/delete/${id}`),\n    post({ owner_token }),\n  );\n  return response.ok;\n}\n\nexport async function setParams(id, owner_token, params) {\n  const response = await fetch(\n    getApiUrl(`/api/params/${id}`),\n    post({\n      owner_token,\n      dlimit: params.dlimit,\n    }),\n  );\n  return response.ok;\n}\n\nexport async function fileInfo(id, owner_token) {\n  const response = await fetch(\n    getApiUrl(`/api/info/${id}`),\n    post({ owner_token }),\n  );\n\n  if (response.ok) {\n    const obj = await response.json();\n    return obj;\n  }\n\n  throw new Error(response.status);\n}\n\nexport async function metadata(id, keychain) {\n  const result = await fetchWithAuthAndRetry(\n    getApiUrl(`/api/metadata/${id}`),\n    { method: \"GET\" },\n    keychain,\n  );\n  if (result.ok) {\n    const data = await result.response.json();\n    const meta = await keychain.decryptMetadata(b64ToArray(data.metadata));\n    return {\n      size: meta.size,\n      ttl: data.ttl,\n      iv: meta.iv,\n      name: meta.name,\n      type: meta.type,\n      manifest: meta.manifest,\n    };\n  }\n  throw new Error(result.response.status);\n}\n\nexport async function setPassword(id, owner_token, keychain) {\n  const auth = await keychain.authKeyB64();\n  const response = await fetch(\n    getApiUrl(`/api/password/${id}`),\n    post({ owner_token, auth }),\n  );\n  return response.ok;\n}\n\nfunction asyncInitWebSocket(server, timeout = 10000) {\n  return new Promise((resolve, reject) => {\n    try {\n      const ws = new WebSocket(server);\n      const timeoutId = setTimeout(() => {\n        ws.close();\n        reject(new Error(\"WebSocket connection timeout\"));\n      }, timeout);\n\n      ws.addEventListener(\n        \"open\",\n        () => {\n          clearTimeout(timeoutId);\n          resolve(ws);\n        },\n        { once: true },\n      );\n\n      ws.addEventListener(\n        \"error\",\n        (e) => {\n          clearTimeout(timeoutId);\n          reject(new ConnectionError(false));\n        },\n        { once: true },\n      );\n    } catch (e) {\n      reject(new ConnectionError(false));\n    }\n  });\n}\n\nfunction listenForResponse(ws, canceller) {\n  return new Promise((resolve, reject) => {\n    function handleClose(event) {\n      // a 'close' event before a 'message' event means the request failed\n      ws.removeEventListener(\"message\", handleMessage);\n      reject(new ConnectionError(canceller.cancelled));\n    }\n    function handleMessage(msg) {\n      ws.removeEventListener(\"close\", handleClose);\n      try {\n        const response = JSON.parse(msg.data);\n        if (response.error) {\n          throw new Error(response.error);\n        } else {\n          resolve(response);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    }\n    ws.addEventListener(\"message\", handleMessage, { once: true });\n    ws.addEventListener(\"close\", handleClose, { once: true });\n  });\n}\n\nasync function upload(\n  stream,\n  metadata,\n  verifierB64,\n  timeLimit,\n  dlimit,\n  onprogress,\n  canceller,\n  ownerWrap,\n  recipientWrap,\n) {\n  let size = 0;\n  const start = Date.now();\n  const host = window.location.hostname;\n  const port = window.location.port;\n  const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n  const endpoint =\n    window.location.protocol === \"file:\"\n      ? fileProtocolWssUrl\n      : `${protocol}//${host}${port ? \":\" : \"\"}${port}/api/ws`;\n\n  // Retry WebSocket connection with exponential backoff\n  let ws;\n  let lastError;\n  const maxRetries = 3;\n\n  for (let attempt = 0; attempt < maxRetries; attempt++) {\n    if (canceller.cancelled) {\n      throw new ConnectionError(true);\n    }\n\n    try {\n      ws = await asyncInitWebSocket(endpoint);\n      break; // Success\n    } catch (e) {\n      lastError = e;\n      if (attempt < maxRetries - 1) {\n        // Exponential backoff: 500ms, 1000ms, 2000ms\n        const backoffMs = 500 * Math.pow(2, attempt);\n        await delay(backoffMs);\n      }\n    }\n  }\n\n  if (!ws) {\n    throw lastError || new ConnectionError(false);\n  }\n\n  try {\n    const metadataHeader = arrayToB64(new Uint8Array(metadata));\n    const fileMeta = {\n      fileMetadata: metadataHeader,\n      authorization: `send-v1 ${verifierB64}`,\n      timeLimit,\n      dlimit,\n    };\n    if (\n      ownerWrap &&\n      ownerWrap.ciphertext &&\n      ownerWrap.nonce &&\n      ownerWrap.ephemeralPublicKey\n    ) {\n      fileMeta.ownerSecretCiphertext = ownerWrap.ciphertext;\n      fileMeta.ownerSecretNonce = ownerWrap.nonce;\n      fileMeta.ownerSecretEphemeralPub = ownerWrap.ephemeralPublicKey;\n      if (ownerWrap.version != null) {\n        fileMeta.ownerSecretVersion = ownerWrap.version;\n      }\n    }\n    // Add recipient encryption data (optional - file encrypted FOR a specific user)\n    if (\n      recipientWrap &&\n      recipientWrap.userId &&\n      recipientWrap.ciphertext &&\n      recipientWrap.nonce &&\n      recipientWrap.ephemeralPublicKey\n    ) {\n      fileMeta.recipientUserId = recipientWrap.userId;\n      fileMeta.recipientSecretCiphertext = recipientWrap.ciphertext;\n      fileMeta.recipientSecretNonce = recipientWrap.nonce;\n      fileMeta.recipientSecretEphemeralPub = recipientWrap.ephemeralPublicKey;\n      if (recipientWrap.version != null) {\n        fileMeta.recipientSecretVersion = recipientWrap.version;\n      }\n    }\n    const uploadInfoResponse = listenForResponse(ws, canceller);\n    ws.send(JSON.stringify(fileMeta));\n    const uploadInfo = await uploadInfoResponse;\n\n    const completedResponse = listenForResponse(ws, canceller);\n\n    const reader = stream.getReader();\n    let state = await reader.read();\n    while (!state.done) {\n      if (canceller.cancelled) {\n        ws.close();\n      }\n      if (ws.readyState !== WebSocket.OPEN) {\n        break;\n      }\n      const buf = state.value;\n      ws.send(buf);\n      onprogress(size);\n      size += buf.length;\n      state = await reader.read();\n      while (\n        ws.bufferedAmount > ECE_RECORD_SIZE * 2 &&\n        ws.readyState === WebSocket.OPEN &&\n        !canceller.cancelled\n      ) {\n        await delay();\n      }\n    }\n    if (ws.readyState === WebSocket.OPEN) {\n      ws.send(new Uint8Array([0])); //EOF\n    }\n\n    await completedResponse;\n    uploadInfo.duration = Date.now() - start;\n    return uploadInfo;\n  } catch (e) {\n    e.size = size;\n    e.duration = Date.now() - start;\n    throw e;\n  } finally {\n    if (![WebSocket.CLOSED, WebSocket.CLOSING].includes(ws.readyState)) {\n      ws.close();\n    }\n  }\n}\n\nexport function uploadWs(\n  encrypted,\n  metadata,\n  verifierB64,\n  timeLimit,\n  dlimit,\n  onprogress,\n  ownerWrap = null,\n  recipientWrap = null,\n) {\n  const canceller = { cancelled: false };\n\n  return {\n    cancel: function () {\n      canceller.cancelled = true;\n    },\n\n    result: upload(\n      encrypted,\n      metadata,\n      verifierB64,\n      timeLimit,\n      dlimit,\n      onprogress,\n      canceller,\n      ownerWrap,\n      recipientWrap,\n    ),\n  };\n}\n\n////////////////////////\n\nasync function downloadS(id, keychain, signal) {\n  const auth = await keychain.authHeader();\n\n  const response = await fetch(getApiUrl(`/api/download/${id}`), {\n    signal: signal,\n    method: \"GET\",\n    headers: { Authorization: auth },\n  });\n\n  const authHeader = response.headers.get(\"WWW-Authenticate\");\n  if (authHeader) {\n    keychain.nonce = parseNonce(authHeader);\n  }\n\n  if (response.status !== 200) {\n    throw new Error(response.status);\n  }\n\n  return response.body;\n}\n\nasync function tryDownloadStream(id, keychain, signal, tries = 2) {\n  try {\n    const result = await downloadS(id, keychain, signal);\n    return result;\n  } catch (e) {\n    if (e.message === \"401\" && --tries > 0) {\n      return tryDownloadStream(id, keychain, signal, tries);\n    }\n    if (e.name === \"AbortError\") {\n      throw new Error(\"0\");\n    }\n    throw e;\n  }\n}\n\nexport function downloadStream(id, keychain) {\n  const controller = new AbortController();\n  function cancel() {\n    controller.abort();\n  }\n  return {\n    cancel,\n    result: tryDownloadStream(id, keychain, controller.signal),\n  };\n}\n\n//////////////////\n\nasync function download(id, keychain, onprogress, canceller) {\n  const auth = await keychain.authHeader();\n  const xhr = new XMLHttpRequest();\n  canceller.oncancel = function () {\n    xhr.abort();\n  };\n  return new Promise(function (resolve, reject) {\n    xhr.addEventListener(\"loadend\", function () {\n      canceller.oncancel = function () {};\n      const authHeader = xhr.getResponseHeader(\"WWW-Authenticate\");\n      if (authHeader) {\n        keychain.nonce = parseNonce(authHeader);\n      }\n      if (xhr.status !== 200) {\n        return reject(new Error(xhr.status));\n      }\n\n      const blob = new Blob([xhr.response]);\n      resolve(blob);\n    });\n\n    xhr.addEventListener(\"progress\", function (event) {\n      if (event.target.status === 200) {\n        onprogress(event.loaded);\n      }\n    });\n    xhr.open(\"get\", getApiUrl(`/api/download/blob/${id}`));\n    xhr.setRequestHeader(\"Authorization\", auth);\n    xhr.responseType = \"blob\";\n    xhr.send();\n    onprogress(0);\n  });\n}\n\nasync function tryDownload(id, keychain, onprogress, canceller, tries = 2) {\n  try {\n    const result = await download(id, keychain, onprogress, canceller);\n    return result;\n  } catch (e) {\n    if (e.message === \"401\" && --tries > 0) {\n      return tryDownload(id, keychain, onprogress, canceller, tries);\n    }\n    throw e;\n  }\n}\n\nexport function downloadFile(id, keychain, onprogress) {\n  const canceller = {\n    oncancel: function () {}, // download() sets this\n  };\n  function cancel() {\n    canceller.oncancel();\n  }\n  return {\n    cancel,\n    result: tryDownload(id, keychain, onprogress, canceller),\n  };\n}\n\nexport async function getFileList(bearerToken, kid) {\n  const headers = new Headers({ Authorization: `Bearer ${bearerToken}` });\n  const response = await fetch(getApiUrl(`/api/filelist/${kid}`), { headers });\n  if (response.ok) {\n    const encrypted = await response.blob();\n    return encrypted;\n  }\n  throw new Error(response.status);\n}\n\nexport async function setFileList(bearerToken, kid, data) {\n  const headers = new Headers({ Authorization: `Bearer ${bearerToken}` });\n  const response = await fetch(getApiUrl(`/api/filelist/${kid}`), {\n    headers,\n    method: \"POST\",\n    body: data,\n  });\n  return response.ok;\n}\n\nexport async function getConstants() {\n  const response = await fetch(getApiUrl(\"/config\"));\n\n  if (response.ok) {\n    const obj = await response.json();\n    return obj;\n  }\n\n  throw new Error(response.status);\n}\n\nexport async function fetchUsers() {\n  const response = await fetch(getApiUrl(\"/api/users\"));\n\n  if (response.ok) {\n    const data = await response.json();\n    return data.users || [];\n  }\n\n  throw new Error(response.status);\n}\n\nexport async function fetchInbox() {\n  const response = await fetch(getApiUrl(\"/api/me/inbox\"));\n\n  if (response.ok) {\n    const data = await response.json();\n    return data.files || [];\n  }\n\n  throw new Error(response.status);\n}\n\nexport async function fetchOutbox() {\n  const response = await fetch(getApiUrl(\"/api/me/outbox\"));\n\n  if (response.ok) {\n    const data = await response.json();\n    return data.files || [];\n  }\n\n  throw new Error(response.status);\n}\n\nexport async function fetchFileInfo(fileID) {\n  const response = await fetch(getApiUrl(`/api/me/file-info/${fileID}`));\n\n  if (response.ok) {\n    const data = await response.json();\n    return data;\n  }\n\n  throw new Error(response.status);\n}\n", "// Generated by `./pycrc.py --algorithm=table-driven --model=crc-32 --generate=c`\nlet TABLE = [\n    0x00000000, 0x77073096, 0xee0e612c, 0x990951ba, 0x076dc419, 0x706af48f, 0xe963a535, 0x9e6495a3,\n    0x0edb8832, 0x79dcb8a4, 0xe0d5e91e, 0x97d2d988, 0x09b64c2b, 0x7eb17cbd, 0xe7b82d07, 0x90bf1d91,\n    0x1db71064, 0x6ab020f2, 0xf3b97148, 0x84be41de, 0x1adad47d, 0x6ddde4eb, 0xf4d4b551, 0x83d385c7,\n    0x136c9856, 0x646ba8c0, 0xfd62f97a, 0x8a65c9ec, 0x14015c4f, 0x63066cd9, 0xfa0f3d63, 0x8d080df5,\n    0x3b6e20c8, 0x4c69105e, 0xd56041e4, 0xa2677172, 0x3c03e4d1, 0x4b04d447, 0xd20d85fd, 0xa50ab56b,\n    0x35b5a8fa, 0x42b2986c, 0xdbbbc9d6, 0xacbcf940, 0x32d86ce3, 0x45df5c75, 0xdcd60dcf, 0xabd13d59,\n    0x26d930ac, 0x51de003a, 0xc8d75180, 0xbfd06116, 0x21b4f4b5, 0x56b3c423, 0xcfba9599, 0xb8bda50f,\n    0x2802b89e, 0x5f058808, 0xc60cd9b2, 0xb10be924, 0x2f6f7c87, 0x58684c11, 0xc1611dab, 0xb6662d3d,\n    0x76dc4190, 0x01db7106, 0x98d220bc, 0xefd5102a, 0x71b18589, 0x06b6b51f, 0x9fbfe4a5, 0xe8b8d433,\n    0x7807c9a2, 0x0f00f934, 0x9609a88e, 0xe10e9818, 0x7f6a0dbb, 0x086d3d2d, 0x91646c97, 0xe6635c01,\n    0x6b6b51f4, 0x1c6c6162, 0x856530d8, 0xf262004e, 0x6c0695ed, 0x1b01a57b, 0x8208f4c1, 0xf50fc457,\n    0x65b0d9c6, 0x12b7e950, 0x8bbeb8ea, 0xfcb9887c, 0x62dd1ddf, 0x15da2d49, 0x8cd37cf3, 0xfbd44c65,\n    0x4db26158, 0x3ab551ce, 0xa3bc0074, 0xd4bb30e2, 0x4adfa541, 0x3dd895d7, 0xa4d1c46d, 0xd3d6f4fb,\n    0x4369e96a, 0x346ed9fc, 0xad678846, 0xda60b8d0, 0x44042d73, 0x33031de5, 0xaa0a4c5f, 0xdd0d7cc9,\n    0x5005713c, 0x270241aa, 0xbe0b1010, 0xc90c2086, 0x5768b525, 0x206f85b3, 0xb966d409, 0xce61e49f,\n    0x5edef90e, 0x29d9c998, 0xb0d09822, 0xc7d7a8b4, 0x59b33d17, 0x2eb40d81, 0xb7bd5c3b, 0xc0ba6cad,\n    0xedb88320, 0x9abfb3b6, 0x03b6e20c, 0x74b1d29a, 0xead54739, 0x9dd277af, 0x04db2615, 0x73dc1683,\n    0xe3630b12, 0x94643b84, 0x0d6d6a3e, 0x7a6a5aa8, 0xe40ecf0b, 0x9309ff9d, 0x0a00ae27, 0x7d079eb1,\n    0xf00f9344, 0x8708a3d2, 0x1e01f268, 0x6906c2fe, 0xf762575d, 0x806567cb, 0x196c3671, 0x6e6b06e7,\n    0xfed41b76, 0x89d32be0, 0x10da7a5a, 0x67dd4acc, 0xf9b9df6f, 0x8ebeeff9, 0x17b7be43, 0x60b08ed5,\n    0xd6d6a3e8, 0xa1d1937e, 0x38d8c2c4, 0x4fdff252, 0xd1bb67f1, 0xa6bc5767, 0x3fb506dd, 0x48b2364b,\n    0xd80d2bda, 0xaf0a1b4c, 0x36034af6, 0x41047a60, 0xdf60efc3, 0xa867df55, 0x316e8eef, 0x4669be79,\n    0xcb61b38c, 0xbc66831a, 0x256fd2a0, 0x5268e236, 0xcc0c7795, 0xbb0b4703, 0x220216b9, 0x5505262f,\n    0xc5ba3bbe, 0xb2bd0b28, 0x2bb45a92, 0x5cb36a04, 0xc2d7ffa7, 0xb5d0cf31, 0x2cd99e8b, 0x5bdeae1d,\n    0x9b64c2b0, 0xec63f226, 0x756aa39c, 0x026d930a, 0x9c0906a9, 0xeb0e363f, 0x72076785, 0x05005713,\n    0x95bf4a82, 0xe2b87a14, 0x7bb12bae, 0x0cb61b38, 0x92d28e9b, 0xe5d5be0d, 0x7cdcefb7, 0x0bdbdf21,\n    0x86d3d2d4, 0xf1d4e242, 0x68ddb3f8, 0x1fda836e, 0x81be16cd, 0xf6b9265b, 0x6fb077e1, 0x18b74777,\n    0x88085ae6, 0xff0f6a70, 0x66063bca, 0x11010b5c, 0x8f659eff, 0xf862ae69, 0x616bffd3, 0x166ccf45,\n    0xa00ae278, 0xd70dd2ee, 0x4e048354, 0x3903b3c2, 0xa7672661, 0xd06016f7, 0x4969474d, 0x3e6e77db,\n    0xaed16a4a, 0xd9d65adc, 0x40df0b66, 0x37d83bf0, 0xa9bcae53, 0xdebb9ec5, 0x47b2cf7f, 0x30b5ffe9,\n    0xbdbdf21c, 0xcabac28a, 0x53b39330, 0x24b4a3a6, 0xbad03605, 0xcdd70693, 0x54de5729, 0x23d967bf,\n    0xb3667a2e, 0xc4614ab8, 0x5d681b02, 0x2a6f2b94, 0xb40bbe37, 0xc30c8ea1, 0x5a05df1b, 0x2d02ef8d,\n];\nif (typeof Int32Array !== 'undefined') {\n    TABLE = new Int32Array(TABLE);\n}\nconst crc32 = (current, previous) => {\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    let crc = previous === 0 ? 0 : ~~previous ^ -1;\n    for (let index = 0; index < current.length; index++) {\n        crc = TABLE[(crc ^ current[index]) & 0xff] ^ (crc >>> 8);\n    }\n    return crc ^ -1;\n};\nexport default crc32;\n", "// INFO: we use calculators/crc32, bc it operates on a UInt8Array, so it works int the browser\nimport crc32 from \"crc/calculators/crc32\";\n\nconst encoder = new TextEncoder();\n\nfunction dosDateTime(dateTime = new Date()) {\n  const year = (dateTime.getFullYear() - 1980) << 9;\n  const month = (dateTime.getMonth() + 1) << 5;\n  const day = dateTime.getDate();\n  const date = year | month | day;\n  const hour = dateTime.getHours() << 11;\n  const minute = dateTime.getMinutes() << 5;\n  const second = Math.floor(dateTime.getSeconds() / 2);\n  const time = hour | minute | second;\n\n  return { date, time };\n}\n\nclass File {\n  constructor(info) {\n    this.name = encoder.encode(info.name);\n    this.size = info.size;\n    this.bytesRead = 0;\n    this.crc = null;\n    this.dateTime = dosDateTime();\n  }\n\n  get header() {\n    const h = new ArrayBuffer(30 + this.name.byteLength);\n    const v = new DataView(h);\n    v.setUint32(0, 0x04034b50, true); // sig\n    v.setUint16(4, 20, true); // version\n    v.setUint16(6, 0x808, true); // bit flags (use data descriptor(8) + utf8-encoded(8 << 8))\n    v.setUint16(8, 0, true); // compression\n    v.setUint16(10, this.dateTime.time, true); // modified time\n    v.setUint16(12, this.dateTime.date, true); // modified date\n    v.setUint32(14, 0, true); // crc32 (in descriptor)\n    v.setUint32(18, 0, true); // compressed size (in descriptor)\n    v.setUint32(22, 0, true); // uncompressed size (in descriptor)\n    v.setUint16(26, this.name.byteLength, true); // name length\n    v.setUint16(28, 0, true); // extra field length\n    for (let i = 0; i < this.name.byteLength; i++) {\n      v.setUint8(30 + i, this.name[i]);\n    }\n    return new Uint8Array(h);\n  }\n\n  get dataDescriptor() {\n    const dd = new ArrayBuffer(16);\n    const v = new DataView(dd);\n    v.setUint32(0, 0x08074b50, true); // sig\n    v.setUint32(4, this.crc, true); // crc32\n    v.setUint32(8, this.size, true); // compressed size\n    v.setUint32(12, this.size, true); // uncompressed size\n    return new Uint8Array(dd);\n  }\n\n  directoryRecord(offset) {\n    const dr = new ArrayBuffer(46 + this.name.byteLength);\n    const v = new DataView(dr);\n    v.setUint32(0, 0x02014b50, true); // sig\n    v.setUint16(4, 20, true); // version made\n    v.setUint16(6, 20, true); // version required\n    v.setUint16(8, 0x808, true); // bit flags (use data descriptor(8) + utf8-encoded(8 << 8))\n    v.setUint16(10, 0, true); // compression\n    v.setUint16(12, this.dateTime.time, true); // modified time\n    v.setUint16(14, this.dateTime.date, true); // modified date\n    v.setUint32(16, this.crc, true); // crc\n    v.setUint32(20, this.size, true); // compressed size\n    v.setUint32(24, this.size, true); // uncompressed size\n    v.setUint16(28, this.name.byteLength, true); // name length\n    v.setUint16(30, 0, true); // extra length\n    v.setUint16(32, 0, true); // comment length\n    v.setUint16(34, 0, true); // disk number\n    v.setUint16(36, 0, true); // internal file attrs\n    v.setUint32(38, 0, true); // external file attrs\n    v.setUint32(42, offset, true); // file offset\n    for (let i = 0; i < this.name.byteLength; i++) {\n      v.setUint8(46 + i, this.name[i]);\n    }\n    return new Uint8Array(dr);\n  }\n\n  get byteLength() {\n    return this.size + this.name.byteLength + 30 + 16;\n  }\n\n  append(data, controller) {\n    this.bytesRead += data.byteLength;\n    const endIndex = data.byteLength - Math.max(this.bytesRead - this.size, 0);\n    const buf = data.slice(0, endIndex);\n    this.crc = crc32(buf, this.crc);\n    controller.enqueue(buf);\n    if (endIndex < data.byteLength) {\n      return data.slice(endIndex, data.byteLength);\n    }\n  }\n}\n\nfunction centralDirectory(files, controller) {\n  let directoryOffset = 0;\n  let directorySize = 0;\n  for (let i = 0; i < files.length; i++) {\n    const file = files[i];\n    const record = file.directoryRecord(directoryOffset);\n    directoryOffset += file.byteLength;\n    controller.enqueue(record);\n    directorySize += record.byteLength;\n  }\n  controller.enqueue(eod(files.length, directorySize, directoryOffset));\n}\n\nfunction eod(fileCount, directorySize, directoryOffset) {\n  const e = new ArrayBuffer(22);\n  const v = new DataView(e);\n  v.setUint32(0, 0x06054b50, true); // sig\n  v.setUint16(4, 0, true); // disk number\n  v.setUint16(6, 0, true); // directory disk\n  v.setUint16(8, fileCount, true); // number of records\n  v.setUint16(10, fileCount, true); // total records\n  v.setUint32(12, directorySize, true); // size of directory\n  v.setUint32(16, directoryOffset, true); // offset of directory\n  v.setUint16(20, 0, true); // comment length\n  return new Uint8Array(e);\n}\n\nclass ZipStreamController {\n  constructor(files, source) {\n    this.files = files;\n    this.fileIndex = 0;\n    this.file = null;\n    this.reader = source.getReader();\n    this.nextFile();\n    this.extra = null;\n  }\n\n  nextFile() {\n    this.file = this.files[this.fileIndex++];\n  }\n\n  async pull(controller) {\n    if (!this.file) {\n      // end of archive\n      centralDirectory(this.files, controller);\n      return controller.close();\n    }\n    if (this.file.bytesRead === 0) {\n      // beginning of file\n      controller.enqueue(this.file.header);\n      if (this.extra) {\n        this.extra = this.file.append(this.extra, controller);\n      }\n    }\n    if (this.file.bytesRead >= this.file.size) {\n      // end of file\n      controller.enqueue(this.file.dataDescriptor);\n      this.nextFile();\n      return this.pull(controller);\n    }\n    const data = await this.reader.read();\n    if (data.done) {\n      this.nextFile();\n      return this.pull(controller);\n    }\n    this.extra = this.file.append(data.value, controller);\n  }\n}\n\nexport default class Zip {\n  constructor(manifest, source) {\n    this.files = manifest.files.map((info) => new File(info));\n    this.source = source;\n  }\n\n  get stream() {\n    return new ReadableStream(new ZipStreamController(this.files, this.source));\n  }\n\n  get size() {\n    const entries = this.files.reduce(\n      (total, file) => total + file.byteLength * 2 - file.size,\n      0,\n    );\n    const eod = 22;\n    return entries + eod;\n  }\n}\n", "import { version } from \"../package.json\";\nimport Keychain from \"./keychain\";\nimport { downloadStream } from \"./api\";\nimport { transformStream } from \"./streams\";\nimport Zip from \"./zip\";\n\n// Content-Disposition header generator with ASCII fallback\nfunction contentDisposition(filename) {\n  // ASCII fallback for old browsers + modern UTF-8 encoding\n  const asciiName = filename.replace(/[^\\x20-\\x7E]/g, \"_\");\n  const encodedName = encodeURIComponent(filename);\n  return `attachment; filename=\"${asciiName}\"; filename*=UTF-8''${encodedName}`;\n}\n\nlet noSave = false;\nconst map = new Map();\nconst IMAGES = /.*\\.(png|svg|jpg)$/;\nconst VERSIONED_ASSET = /\\.[A-Fa-f0-9]{8}\\.(js|css|png|svg|jpg)(#\\w+)?$/;\nconst DOWNLOAD_URL = /\\/api\\/download\\/([A-Fa-f0-9]{4,})/;\nconst FONT = /\\.woff2?$/;\n\nself.addEventListener(\"install\", () => {\n  self.skipWaiting();\n});\n\nself.addEventListener(\"activate\", (event) => {\n  event.waitUntil(self.clients.claim());\n});\n\nasync function decryptStream(id, signal) {\n  const file = map.get(id);\n  if (!file) {\n    console.error(\"[SW] File not found in map for id:\", id);\n    return new Response(null, { status: 400 });\n  }\n\n  if (signal && signal.aborted) {\n    console.log(\"[SW] Request already aborted for\", id);\n    map.delete(id);\n    return new Response(null, { status: 499 });\n  }\n  console.log(\"[SW] Starting decryptStream for\", id, \"with nonce:\", file.nonce);\n  let abortHandler = null;\n  try {\n    let size = file.size;\n    let type = file.type;\n    const keychain = new Keychain(file.key, file.nonce);\n    if (file.requiresPassword) {\n      keychain.setPassword(file.password, file.url);\n    }\n\n    console.log(\"[SW] Calling downloadStream...\");\n    file.download = downloadStream(id, keychain);\n\n    if (signal && typeof signal.addEventListener === \"function\") {\n      abortHandler = () => {\n        console.log(\"[SW] Request aborted for\", id);\n        try {\n          if (file.download && typeof file.download.cancel === \"function\") {\n            file.download.cancel();\n          }\n        } catch (err) {\n          console.warn(\"[SW] Failed to cancel download after abort\", err);\n        }\n        map.delete(id);\n      };\n      signal.addEventListener(\"abort\", abortHandler, { once: true });\n    }\n\n    const body = await file.download.result;\n\n    const decrypted = keychain.decryptStream(body);\n\n    let zipStream = null;\n    if (file.type === \"send-archive\") {\n      const zip = new Zip(file.manifest, decrypted);\n      zipStream = zip.stream;\n      type = \"application/zip\";\n      size = zip.size;\n    }\n    const responseStream = transformStream(\n      zipStream || decrypted,\n      {\n        transform(chunk, controller) {\n          file.progress += chunk.length;\n          if (signal && abortHandler && file.progress >= size) {\n            signal.removeEventListener(\"abort\", abortHandler);\n          }\n          controller.enqueue(chunk);\n        },\n      },\n      function oncancel() {\n        // NOTE: cancel doesn't currently fire on chrome\n        // https://bugs.chromium.org/p/chromium/issues/detail?id=638494\n        file.download.cancel();\n        map.delete(id);\n      },\n    );\n\n    const headers = {\n      \"Content-Disposition\": contentDisposition(file.filename),\n      \"Content-Type\": type,\n      \"Content-Length\": size,\n    };\n    console.log(\"[SW] Returning decrypted stream response\");\n    return new Response(responseStream, { headers });\n  } catch (e) {\n    if (e && (e.message === \"0\" || e.name === \"AbortError\")) {\n      console.log(\"[SW] Download aborted for\", id);\n      return new Response(null, { status: 499 });\n    }\n    console.error(\"[SW] Error in decryptStream:\", e, \"noSave:\", noSave);\n    if (noSave) {\n      return new Response(null, { status: e.message });\n    }\n\n    console.log(\"[SW] Redirecting to download page\");\n    return new Response(null, {\n      status: 302,\n      headers: {\n        Location: `/download/${id}/#${file.key}`,\n      },\n    });\n  } finally {\n    if (signal && abortHandler) {\n      signal.removeEventListener(\"abort\", abortHandler);\n    }\n  }\n}\n\nself.addEventListener('fetch', (event) => {\n  const req = event.request;\n  if (req.method !== \"GET\") return;\n  const url = new URL(req.url);\n  const dlmatch = DOWNLOAD_URL.exec(url.pathname);\n  if (dlmatch) {\n    console.log(\"[SW] Intercepted download request for:\", dlmatch[1]);\n    event.respondWith(decryptStream(dlmatch[1], event.request.signal));\n  }\n});\n\nself.addEventListener('message', (event) => {\n  if (event.data.request === \"init\") {\n    console.log(\n      \"[SW] Received init message for\",\n      event.data.id,\n      \"nonce:\",\n      event.data.nonce,\n    );\n    noSave = event.data.noSave;\n    const info = {\n      key: event.data.key,\n      nonce: event.data.nonce,\n      filename: event.data.filename,\n      requiresPassword: event.data.requiresPassword,\n      password: event.data.password,\n      url: event.data.url,\n      type: event.data.type,\n      manifest: event.data.manifest,\n      size: event.data.size,\n      progress: 0,\n    };\n    map.set(event.data.id, info);\n    console.log(\"[SW] File info stored in map\");\n\n    event.ports[0].postMessage(\"file info received\");\n  } else if (event.data.request === \"progress\") {\n    const file = map.get(event.data.id);\n    if (!file) {\n      event.ports[0].postMessage({ error: \"cancelled\" });\n    } else {\n      if (file.progress === file.size) {\n        map.delete(event.data.id);\n      }\n      event.ports[0].postMessage({ progress: file.progress });\n    }\n  } else if (event.data.request === \"cancel\") {\n    const file = map.get(event.data.id);\n    if (file) {\n      if (file.download) {\n        file.download.cancel();\n      }\n      map.delete(event.data.id);\n    }\n    event.ports[0].postMessage(\"download cancelled\");\n  }\n});\n"],
  "mappings": "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AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EACpF;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EACpF;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EACpF;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EACpF;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EACpF;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EACpF;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EACpF;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EACpF;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EACpF;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EACpF;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EACpF;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EACpF;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EACpF;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EACpF;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EACpF;AAAA,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",
  "names": ["delay", "result", "offset", "encoder", "metadata", "metadata", "encoder", "eod", "decryptStream"]
}
