import{n as i}from"./chunk.B5PI22HI.js";var a=class extends HTMLElement{constructor(){super(),this.uploadArea=null,this.uploadRight=null,this.app=null,this._waitingForUploadAreaUpgrade=!1,this._waitingForUploadRightUpgrade=!1,this.state={stage:"empty",files:[],totalSize:0,progress:0,uploadedFile:null},this._postMountFrame=null,this._templateMounted=!1,this._handlersBound=!1,this._boundHandlers={addfiles:this.handleAddFiles.bind(this),removeupload:this.handleRemoveUpload.bind(this),upload:this.handleUpload.bind(this),cancel:this.handleCancel.bind(this),completeAcknowledged:this.handleCompleteAcknowledged.bind(this),retry:this.handleRetry.bind(this),errorDismiss:this.handleErrorDismiss.bind(this)}}connectedCallback(){if(!this._templateMounted){let e=document.getElementById("upload-layout");if(!e){console.error("Template #upload-layout not found");return}let t=e.content.cloneNode(!0);this.appendChild(t),this._templateMounted=!0}this._postMountFrame!==null&&cancelAnimationFrame(this._postMountFrame),this._postMountFrame=requestAnimationFrame(()=>{this._postMountFrame=null,this.isConnected&&(i(this),this.uploadArea=this.querySelector("upload-area"),this.uploadRight=this.querySelector("upload-right"),this.app=this.closest("go-send")||this.app,this._handlersBound||(this.addEventListener("addfiles",this._boundHandlers.addfiles),this.addEventListener("removeupload",this._boundHandlers.removeupload),this.addEventListener("upload",this._boundHandlers.upload),this.addEventListener("cancel",this._boundHandlers.cancel),this.addEventListener("complete-acknowledged",this._boundHandlers.completeAcknowledged),this.addEventListener("retry",this._boundHandlers.retry),this.addEventListener("error-dismiss",this._boundHandlers.errorDismiss),this._handlersBound=!0),this.refreshArchiveState(),this.refreshUploadList())})}disconnectedCallback(){this._postMountFrame!==null&&(cancelAnimationFrame(this._postMountFrame),this._postMountFrame=null),this._handlersBound&&(this.removeEventListener("addfiles",this._boundHandlers.addfiles),this.removeEventListener("removeupload",this._boundHandlers.removeupload),this.removeEventListener("upload",this._boundHandlers.upload),this.removeEventListener("cancel",this._boundHandlers.cancel),this.removeEventListener("complete-acknowledged",this._boundHandlers.completeAcknowledged),this.removeEventListener("retry",this._boundHandlers.retry),this.removeEventListener("error-dismiss",this._boundHandlers.errorDismiss),this._handlersBound=!1)}handleAddFiles(e){let{files:t}=e.detail;console.log("upload-layout: addfiles",{files:t,totalSize:t.reduce((s,o)=>s+o.size,0)}),queueMicrotask(()=>this.refreshArchiveState())}handleRemoveUpload(e){console.log("upload-layout: removeupload",e.detail),queueMicrotask(()=>this.refreshArchiveState())}handleUpload(e){this.state.stage="uploading",this.uploadArea&&typeof this.uploadArea.ensureView=="function"&&this.uploadArea.ensureView("uploading"),console.log("upload-layout: starting upload"),queueMicrotask(()=>this.refreshArchiveState())}handleCancel(e){this.state.stage="selected",this.state.progress=0,console.log("upload-layout: upload cancelled"),this.refreshArchiveState()}handleRetry(e){console.log("[UploadLayout] Retry event received from error view"),this.uploadArea&&typeof this.uploadArea.clearError=="function"?(console.log("[UploadLayout] Calling uploadArea.clearError()"),this.uploadArea.clearError()):console.warn("[UploadLayout] uploadArea.clearError not available",this.uploadArea),this.refreshArchiveState()}handleErrorDismiss(e){console.log("[UploadLayout] Error-dismiss event received from error view"),this.uploadArea&&typeof this.uploadArea.clearError=="function"?(console.log("[UploadLayout] Calling uploadArea.clearError()"),this.uploadArea.clearError()):console.warn("[UploadLayout] uploadArea.clearError not available",this.uploadArea),this.app&&this.app.state&&this.app.state.archive&&(console.log("[UploadLayout] Clearing archive"),this.app.state.archive.clear()),this.refreshArchiveState()}handleCompleteAcknowledged(e){console.log("upload-layout: complete acknowledged"),this.state.stage="empty",this.state.uploadedFile=null,this.uploadArea&&typeof this.uploadArea.clearComplete=="function"&&this.uploadArea.clearComplete(),this.refreshUploadList()}updateProgress(e,t,s){this.state.progress=e,this.uploadArea&&typeof this.uploadArea.updateProgress=="function"&&this.uploadArea.updateProgress(e,t,s)}setUploadComplete(e){this.state.stage="complete",this.state.uploadedFile=e,this.uploadArea&&(typeof this.uploadArea.ensureView=="function"&&this.uploadArea.ensureView("complete"),typeof this.uploadArea.setUploadedFile=="function"&&this.uploadArea.setUploadedFile(e)),this.refreshUploadList(),console.log("upload-layout: upload complete",e)}reset(){this.state={stage:"empty",files:[],totalSize:0,progress:0,uploadedFile:null},this.uploadArea&&typeof this.uploadArea.ensureView=="function"&&this.uploadArea.ensureView("empty"),this.uploadRight&&this.uploadRight.showIntro(),this.refreshArchiveState()}refreshArchiveState(){if(this.app||(this.app=this.closest("go-send")||this.app),!(!this.app||!this.uploadArea||!this.app.state)){if(typeof this.uploadArea.refresh!="function"){this._waitingForUploadAreaUpgrade||(this._waitingForUploadAreaUpgrade=!0,customElements.whenDefined("upload-area").then(()=>{this.uploadArea=this.querySelector("upload-area"),this._waitingForUploadAreaUpgrade=!1,this.refreshArchiveState()}).catch(()=>{this._waitingForUploadAreaUpgrade=!1}));return}this.uploadArea.refresh()}}refreshUploadList(){if(this.app||(this.app=this.closest("go-send")||this.app),!this.app||!this.uploadRight||!this.app.state)return;if(typeof this.uploadRight.showUploadList!="function"){this._waitingForUploadRightUpgrade||(this._waitingForUploadRightUpgrade=!0,customElements.whenDefined("upload-right").then(()=>{this.uploadRight=this.querySelector("upload-right"),this._waitingForUploadRightUpgrade=!1,this.refreshUploadList()}).catch(()=>{this._waitingForUploadRightUpgrade=!1}));return}let t=(this.app.state.storage?this.app.state.storage.files:[]).filter(s=>!s.expired);t.length>0?this.uploadRight.currentTemplate!=="list"?this.uploadRight.showUploadList(t):this.uploadRight.refreshList(t):this.uploadRight.currentTemplate!=="intro"&&this.uploadRight.showIntro()}};customElements.define("upload-layout",a);
