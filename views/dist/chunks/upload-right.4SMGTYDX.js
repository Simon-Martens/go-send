import{a as y}from"./chunk.LITPCYMN.js";import{i as T}from"./chunk.RASS3VP2.js";import"./chunk.EL6E2633.js";import{A as _,f as E,l as L,v as S}from"./chunk.NJSDOF6A.js";import"./chunk.XOPNHUSF.js";var C=class extends HTMLElement{constructor(){super(),this.currentTemplate=null,this.translate=null,this.elements={uploadList:null},this._afterPaintFrame=null}connectedCallback(){window.initialState&&window.initialState.translate&&(this.translate=window.initialState.translate),this.showIntro()}disconnectedCallback(){this._afterPaintFrame!==null&&(cancelAnimationFrame(this._afterPaintFrame),this._afterPaintFrame=null)}_renderTemplate(e,n){let t=document.getElementById(e);if(!t){console.error(`Template #${e} not found`);return}let r=t.content.cloneNode(!0);this.innerHTML="",this.appendChild(r),this._afterPaintFrame!==null&&cancelAnimationFrame(this._afterPaintFrame),this._afterPaintFrame=requestAnimationFrame(()=>{this._afterPaintFrame=null,this.isConnected&&(_(this),typeof n=="function"&&n())})}showIntro(){this._renderTemplate("upload-title",()=>{this.currentTemplate="intro"})}showUploadList(e=[]){this._renderTemplate("upload-list",()=>{this.elements.uploadList=this.querySelector("#upload-list-container"),this.currentTemplate="list",e&&e.length>0&&e.filter(t=>!t.expired).reverse().forEach(t=>this.addUpload(t))})}addUpload(e){if(this.currentTemplate!=="list"||!this.elements.uploadList){console.warn("addUpload called but not in list template");return}let n=document.getElementById("upload-tile-item");if(!n){console.error("Template #upload-tile-item not found");return}let t=n.content.cloneNode(!0),r=t.querySelector("li");r.setAttribute("data-upload-id",e.id);let i=t.querySelector('[data-role="file-name"]');i&&(i.textContent=e.name);let a=t.querySelector('[data-role="file-size"]');a&&(a.textContent=L(e.size));let o=t.querySelector('[data-role="upload-date"]');o&&(o.textContent=this._formatDate(e.createdAt));let d=t.querySelector('[data-role="expiry-info"]');d&&(d.innerHTML=this._createExpiryHTML(e));let l=t.querySelector('[data-role="file-icon"]');l&&e.name&&e.name.toLowerCase().endsWith(".zip")&&(l.className="ri-folder-6-line h-8 w-8 flex-shrink-0 text-primary text-3xl leading-8");let c=t.querySelector('[data-role="file-details"]');c&&e.manifest&&e.manifest.files&&e.manifest.files.length>1&&(c.innerHTML=this._createFileDetailsHTML(e.manifest.files));let u=t.querySelector('[data-role="download-link"]');u&&(u.href=e.url);let m=t.querySelector('[data-role="file-ownership"]');m&&(m.innerHTML=this._createOwnershipHTML(e));let f=t.querySelector('[data-action="delete"]');f&&f.addEventListener("click",s=>this._handleDeleteClick(s,e));let p=t.querySelector('[data-action="copy"]');p&&p.addEventListener("click",s=>this._handleCopyClick(s,e.url));let x=t.querySelector('[data-role="recipient-notice"]');if(e.recipients&&e.recipients.length>0&&p&&p.classList.add("hidden"),x&&x.classList.add("hidden"),console.log(e),e.recipients&&e.recipients.length>0){let s=t.querySelector('[data-role="file-is-secure"]');if(s){s.classList.remove("hidden");let h=this._translateText("fileTileRecipientNotice","The recipient must login to download this file");y(s,h,{position:"top",default:"closed"})}}else if(console.log("No recipients"),e._hasPassword){console.log("Has password");let s=t.querySelector('[data-role="file-is-sharable"]');if(s){s.classList.remove("hidden");let h=this._translateText("fileTileSharableNotice","Share this link and the password over two different channels (eg. eMail, encrypted Messenger)");y(s,h,{position:"top",default:"closed"})}}else{console.log("Has no password");let s=t.querySelector('[data-role="file-is-unshareable"]');if(s){s.classList.remove("hidden");let h=this._translateText("fileTileUnshareableNotice","The link is secret. It is inadvisable to share the link over any unencrypted channel (eg. eMail)");y(s,h,{position:"top",default:"closed"})}}let g=t.querySelector('[data-role="file-is-pwd-protected"]');if(g&&e.hasPassword){g.classList.remove("hidden");let s=this._translateText("fileTilePwdProtectedNotice","File is password protected");y(g,s,{position:"top",default:"closed"})}this.elements.uploadList.prepend(r),requestAnimationFrame(()=>{_(r)})}removeUpload(e){if(this.currentTemplate!=="list"||!this.elements.uploadList){console.warn("removeUpload called but not in list template");return}let n=this.querySelector(`[data-upload-id="${e}"]`);n&&n.remove(),this.elements.uploadList.children.length===0&&this.showIntro()}refreshList(e){if(this.currentTemplate!=="list")return;this.elements.uploadList&&(this.elements.uploadList.innerHTML="");let n=e.filter(t=>!t.expired).reverse();if(n.length===0){this.showIntro();return}n.forEach(t=>this.addUpload(t))}_createExpiryHTML(e){let n=e.dlimit-e.dtotal,t=e.expiresAt-Date.now();if(t<0||n<=0)return this._translateText("linkExpiredAlt","Link expired");let r=S(t),i=this._translateText("downloadCount",`${n} downloads`,{num:n}),a=this._translateText(r.id,this._formatTimeLeft(t),r);return this._translateText("archiveExpiryInfo",`Expires after ${i} or ${a}`,{downloadCount:i,timespan:a})}_createFileDetailsHTML(e){let n=this._translateText("fileCount",`${e.length} files`,{num:e.length}),t=document.getElementById("upload-file-details");if(!t)return console.error("Template #upload-file-details not found"),"";let i=t.content.cloneNode(!0).querySelector("details"),a=i.querySelector('[data-role="file-count"]');a&&(a.textContent=n);let o=i.querySelector('[data-role="file-list"]');if(!o)return console.error("File list container not found"),i.outerHTML;let d=document.getElementById("upload-file-details-item");return d?(e.forEach(l=>{let c=d.content.cloneNode(!0),u=c.querySelector('[data-role="item-name"]');u&&(u.textContent=l.name);let m=c.querySelector('[data-role="item-size"]');m&&(m.textContent=L(l.size));let f=c.querySelector('[data-role="file-icon"]');f&&l.name&&l.name.toLowerCase().endsWith(".zip")&&(f.className="ri-folder-6-line h-6 w-6 text-primary flex-shrink-0 text-2xl leading-6"),o.appendChild(c)}),i.outerHTML):(console.error("Template #upload-file-details-item not found"),i.outerHTML)}_formatTimeLeft(e){let n=Math.floor(e/1e3),t=Math.floor(n/60),r=Math.floor(t/60),i=Math.floor(r/24);return i>=1?`${i} day${i!==1?"s":""}`:r>=1?`${r} hour${r!==1?"s":""}`:t>=1?`${t} minute${t!==1?"s":""}`:"< 1 minute"}_formatDate(e){if(!e)return"";let n=new Date(e),t=new Date,r=new Date(t.getFullYear(),t.getMonth(),t.getDate()),i=new Date(n.getFullYear(),n.getMonth(),n.getDate()),a=document.documentElement.lang||navigator.language||"en";return i.getTime()===r.getTime()?new Intl.DateTimeFormat(a,{hour:"2-digit",minute:"2-digit"}).format(n):n.getFullYear()===t.getFullYear()?new Intl.DateTimeFormat(a,{month:"short",day:"numeric"}).format(n):new Intl.DateTimeFormat(a,{year:"numeric",month:"short",day:"numeric"}).format(n)}_translateText(e,n,t={}){if(this.translate)try{return this.translate(e,t)}catch{}if(window.translate)try{return window.translate(e,t)}catch{}return n}_getCurrentUserName(){return T&&T.user&&T.user.name?T.user.name.toLowerCase():null}_createOwnershipHTML(e){let n=[],t=this._getCurrentUserName();if(e.ownerString){if(!(t&&e.ownerString.toLowerCase()===t.toLowerCase())){let i=this._translateText("fileTileFrom","FROM");n.push(`<span class="inline-flex items-center px-2 py-1 rounded bg-primary/10 dark:bg-primary/20 text-primary text-xs">${i}: ${e.ownerString}</span>`)}}else if(e.authString){let r=this._translateText("fileTileFrom","FROM"),i=this._translateText("fileTileGuest","Guest");n.push(`<span class="inline-flex items-center px-2 py-1 rounded bg-primary/10 dark:bg-primary/20 text-primary text-xs">${r}: ${e.authString}</span><span class="inline-flex items-center px-2 py-1 rounded bg-grey-20 dark:bg-grey-80 text-xs normal-case">${i}</span>`)}if(Array.isArray(e.recipients)&&e.recipients.length>0){let r=this._translateText("fileTileTo","TO");e.recipients.filter(a=>!t||!a.userName?!0:a.userName.toLowerCase()!==t.toLowerCase()).forEach(a=>{let o=a.userName||a.userEmail||`User ${a.userId}`;n.push(`<span class="inline-flex items-center px-2 py-1 rounded bg-secondary/10 dark:bg-secondary/20 text-secondary text-xs">${r}: ${o}</span>`)})}return n.join("")}_handleCopyClick(e,n){if(e.preventDefault(),e.stopPropagation(),E(n)){this.dispatchEvent(new CustomEvent("copy",{bubbles:!0,detail:{url:n}}));let r=e.currentTarget,i=r.querySelector('[data-role="copy-icon"]'),a=r.querySelector('[id="copyLinkButton"]');if(i){let o=i.className;i.className="ri-check-line h-4 w-4 mr-2 text-base leading-4",setTimeout(()=>{i.className=o},1e3)}if(a){let o=a.textContent;a.textContent=this._translateText("copiedUrl","Copied!"),setTimeout(()=>{a.textContent=o},1e3)}}}_handleDeleteClick(e,n){e.preventDefault(),e.stopPropagation(),this.dispatchEvent(new CustomEvent("delete",{bubbles:!0,detail:{ownedFile:n}}))}};customElements.define("upload-right",C);
