import{d as y,e as h,k as x,n as p}from"./chunk.B5PI22HI.js";var T=class extends HTMLElement{constructor(){super(),this.currentTemplate=null,this.translate=null,this.elements={uploadList:null},this._afterPaintFrame=null}connectedCallback(){window.initialState&&window.initialState.translate&&(this.translate=window.initialState.translate),this.showIntro()}disconnectedCallback(){this._afterPaintFrame!==null&&(cancelAnimationFrame(this._afterPaintFrame),this._afterPaintFrame=null)}_renderTemplate(t,n){let e=document.getElementById(t);if(!e){console.error(`Template #${t} not found`);return}let a=e.content.cloneNode(!0);this.innerHTML="",this.appendChild(a),this._afterPaintFrame!==null&&cancelAnimationFrame(this._afterPaintFrame),this._afterPaintFrame=requestAnimationFrame(()=>{this._afterPaintFrame=null,this.isConnected&&(p(this),typeof n=="function"&&n())})}showIntro(){this._renderTemplate("upload-title",()=>{this.currentTemplate="intro"})}showUploadList(t=[]){this._renderTemplate("upload-list",()=>{this.elements.uploadList=this.querySelector("#upload-list-container"),this.currentTemplate="list",t&&t.length>0&&t.filter(e=>!e.expired).reverse().forEach(e=>this.addUpload(e))})}addUpload(t){if(this.currentTemplate!=="list"||!this.elements.uploadList){console.warn("addUpload called but not in list template");return}let n=document.getElementById("upload-tile-item");if(!n){console.error("Template #upload-tile-item not found");return}let e=n.content.cloneNode(!0),a=e.querySelector("li");a.setAttribute("data-upload-id",t.id);let i=e.querySelector('[data-role="file-name"]');i&&(i.textContent=t.name);let r=e.querySelector('[data-role="file-size"]');r&&(r.textContent=h(t.size));let o=e.querySelector('[data-role="upload-date"]');o&&(o.textContent=this._formatDate(t.createdAt));let c=e.querySelector('[data-role="expiry-info"]');c&&(c.innerHTML=this._createExpiryHTML(t));let l=e.querySelector('[data-role="file-icon"]');l&&t.name&&t.name.toLowerCase().endsWith(".zip")&&(l.className="ri-folder-6-line h-8 w-8 flex-shrink-0 text-primary text-3xl leading-8");let s=e.querySelector('[data-role="file-details"]');s&&t.manifest&&t.manifest.files&&t.manifest.files.length>1&&(s.innerHTML=this._createFileDetailsHTML(t.manifest.files));let d=e.querySelector('[data-role="download-link"]');d&&(d.href=t.url);let u=e.querySelector('[data-action="delete"]');u&&u.addEventListener("click",f=>this._handleDeleteClick(f,t));let m=e.querySelector('[data-action="copy"]');m&&m.addEventListener("click",f=>this._handleCopyClick(f,t.url)),this.elements.uploadList.prepend(a),requestAnimationFrame(()=>{p(a)})}removeUpload(t){if(this.currentTemplate!=="list"||!this.elements.uploadList){console.warn("removeUpload called but not in list template");return}let n=this.querySelector(`[data-upload-id="${t}"]`);n&&n.remove(),this.elements.uploadList.children.length===0&&this.showIntro()}refreshList(t){if(this.currentTemplate!=="list")return;this.elements.uploadList&&(this.elements.uploadList.innerHTML="");let n=t.filter(e=>!e.expired).reverse();if(n.length===0){this.showIntro();return}n.forEach(e=>this.addUpload(e))}_createExpiryHTML(t){let n=t.dlimit-t.dtotal,e=t.expiresAt-Date.now();if(e<0||n<=0)return this._translateText("linkExpiredAlt","Link expired");let a=x(e),i=this._translateText("downloadCount",`${n} downloads`,{num:n}),r=this._translateText(a.id,this._formatTimeLeft(e),a);return this._translateText("archiveExpiryInfo",`Expires after ${i} or ${r}`,{downloadCount:i,timespan:r})}_createFileDetailsHTML(t){let n=this._translateText("fileCount",`${t.length} files`,{num:t.length}),e=document.getElementById("upload-file-details");if(!e)return console.error("Template #upload-file-details not found"),"";let i=e.content.cloneNode(!0).querySelector("details"),r=i.querySelector('[data-role="file-count"]');r&&(r.textContent=n);let o=i.querySelector('[data-role="file-list"]');if(!o)return console.error("File list container not found"),i.outerHTML;let c=document.getElementById("upload-file-details-item");return c?(t.forEach(l=>{let s=c.content.cloneNode(!0),d=s.querySelector('[data-role="item-name"]');d&&(d.textContent=l.name);let u=s.querySelector('[data-role="item-size"]');u&&(u.textContent=h(l.size));let m=s.querySelector('[data-role="file-icon"]');m&&l.name&&l.name.toLowerCase().endsWith(".zip")&&(m.className="ri-folder-6-line h-6 w-6 text-primary flex-shrink-0 text-2xl leading-6"),o.appendChild(s)}),i.outerHTML):(console.error("Template #upload-file-details-item not found"),i.outerHTML)}_formatTimeLeft(t){let n=Math.floor(t/1e3),e=Math.floor(n/60),a=Math.floor(e/60),i=Math.floor(a/24);return i>=1?`${i} day${i!==1?"s":""}`:a>=1?`${a} hour${a!==1?"s":""}`:e>=1?`${e} minute${e!==1?"s":""}`:"< 1 minute"}_formatDate(t){if(!t)return"";let n=new Date(t),e=new Date,a=new Date(e.getFullYear(),e.getMonth(),e.getDate()),i=new Date(n.getFullYear(),n.getMonth(),n.getDate()),r=document.documentElement.lang||navigator.language||"en";return i.getTime()===a.getTime()?new Intl.DateTimeFormat(r,{hour:"2-digit",minute:"2-digit"}).format(n):n.getFullYear()===e.getFullYear()?new Intl.DateTimeFormat(r,{month:"short",day:"numeric"}).format(n):new Intl.DateTimeFormat(r,{year:"numeric",month:"short",day:"numeric"}).format(n)}_translateText(t,n,e={}){if(this.translate)try{return this.translate(t,e)}catch{}if(window.translate)try{return window.translate(t,e)}catch{}return n}_handleCopyClick(t,n){if(t.preventDefault(),t.stopPropagation(),y(n)){this.dispatchEvent(new CustomEvent("copy",{bubbles:!0,detail:{url:n}}));let a=t.currentTarget,i=a.querySelector('[data-role="copy-icon"]'),r=a.querySelector('[id="copyLinkButton"]');if(i){let o=i.className;i.className="ri-check-line h-4 w-4 mr-2 text-base leading-4",setTimeout(()=>{i.className=o},1e3)}if(r){let o=r.textContent;r.textContent=this._translateText("copiedUrl","Copied!"),setTimeout(()=>{r.textContent=o},1e3)}}}_handleDeleteClick(t,n){t.preventDefault(),t.stopPropagation(),this.dispatchEvent(new CustomEvent("delete",{bubbles:!0,detail:{ownedFile:n}}))}};customElements.define("upload-right",T);
