package migrations

import (
	"github.com/Simon-Martens/go-send/core"
)

// This is an example migration file showing how to create new migrations
// To use it, remove the .example extension and update the timestamp

func init() {
	// Use current Unix timestamp: date +%s
	Register("1704067300_add_index_example", up_1704067300_add_index_example, down_1704067300_add_index_example)
}

func up_1704067300_add_index_example(app *core.App) error {
	// Example: Add a new index
	_, err := app.DB.DB().Exec(`
		CREATE INDEX IF NOT EXISTS idx_files_created_at ON files(created_at)
	`)
	if err != nil {
		return err
	}

	app.Logger.Info("Added index on files.created_at")
	return nil
}

func down_1704067300_add_index_example(app *core.App) error {
	// Example: Drop the index
	_, err := app.DB.DB().Exec(`
		DROP INDEX IF EXISTS idx_files_created_at
	`)
	if err != nil {
		return err
	}

	app.Logger.Info("Dropped index on files.created_at")
	return nil
}
