import{i as p}from"./chunk.RASS3VP2.js";import{i as y}from"./chunk.EL6E2633.js";import{A as g}from"./chunk.NJSDOF6A.js";import"./chunk.XOPNHUSF.js";var _=class extends HTMLElement{constructor(){super(),this._templateMounted=!1,this._refreshButton=null,this._statusContainer=null,this._statusIcon=null,this._statusText=null,this._tableBody=null,this._emptyState=null,this._countText=null,this._nextButton=null,this._currentPage=1,this._totalCount=0,this._currentLogCount=0,this._isLoading=!1,this._boundRefresh=this._handleRefresh.bind(this),this._boundNext=this._handleNext.bind(this)}connectedCallback(){if(!this._templateMounted){let t=document.getElementById("settings-logs-panel");if(!t){console.error("Template #settings-logs-panel not found");return}let s=t.content.cloneNode(!0);this.appendChild(s),this._templateMounted=!0}this._cacheElements(),g(this),this._attachListeners(),requestAnimationFrame(()=>{this._fetchLogs(1)})}disconnectedCallback(){this._detachListeners(),this._refreshButton=null,this._statusContainer=null,this._statusIcon=null,this._statusText=null,this._tableBody=null,this._emptyState=null,this._countText=null,this._nextButton=null}_cacheElements(){var t,s;this._refreshButton=this.querySelector('[data-role="logs-refresh"]'),this._statusContainer=this.querySelector('[data-role="logs-status"]'),this._statusIcon=(t=this._statusContainer)==null?void 0:t.querySelector('[data-role="logs-status-icon"]'),this._statusText=(s=this._statusContainer)==null?void 0:s.querySelector('[data-role="logs-status-text"]'),this._tableBody=this.querySelector('[data-role="logs-body"]'),this._emptyState=this.querySelector('[data-role="logs-empty"]'),this._countText=this.querySelector('[data-role="logs-count"]'),this._nextButton=this.querySelector('[data-role="logs-next"]')}_attachListeners(){this._refreshButton&&this._refreshButton.addEventListener("click",this._boundRefresh),this._nextButton&&this._nextButton.addEventListener("click",this._boundNext)}_detachListeners(){this._refreshButton&&this._refreshButton.removeEventListener("click",this._boundRefresh),this._nextButton&&this._nextButton.removeEventListener("click",this._boundNext)}async _handleRefresh(){this._fetchLogs(1)}async _handleNext(){this._fetchLogs(this._currentPage+1)}async _fetchLogs(t){if(!this._isLoading){this._isLoading=!0,this._setStatus("Loading logs...","loading");try{let s=await y(t);this._currentPage=s.currentPage,this._totalCount=s.totalCount,this._currentLogCount=s.logs.length,!s.logs||s.logs.length===0?(this._setStatus("No logs available.","empty"),this._showEmptyState()):(this._setStatus(""),this._renderLogs(s.logs)),this._updatePaginationUI()}catch(s){console.error("[SettingsLogsPanel] Error fetching logs:",s),this._setStatus("Failed to load logs.","error")}finally{this._isLoading=!1}}}_setStatus(t,s){if(this._statusContainer){if(!t){this._statusContainer.classList.add("hidden");return}switch(this._statusContainer.classList.remove("hidden"),this._statusIcon&&(this._statusIcon.classList.remove("ri-loader-4-line","ri-error-warning-line","ri-inbox-line"),this._statusIcon.classList.add("hidden")),s){case"loading":this._statusIcon&&(this._statusIcon.classList.remove("hidden"),this._statusIcon.classList.add("ri-loader-4-line","animate-spin"));break;case"error":this._statusIcon&&(this._statusIcon.classList.remove("hidden"),this._statusIcon.classList.add("ri-error-warning-line","text-red-600","dark:text-red-400"));break;case"empty":this._statusIcon&&(this._statusIcon.classList.remove("hidden"),this._statusIcon.classList.add("ri-inbox-line","text-grey-60","dark:text-grey-50"));break}this._statusText&&(this._statusText.textContent=t)}}_showEmptyState(){this._emptyState&&this._emptyState.classList.remove("hidden"),this._tableBody&&(this._tableBody.innerHTML="")}_renderLogs(t){this._tableBody&&(this._emptyState&&this._emptyState.classList.add("hidden"),this._tableBody.innerHTML="",t.forEach(s=>{let n=this._createLogRow(s);this._tableBody.appendChild(n)}))}_createLogRow(t){let s=document.getElementById("settings-logs-row");if(!s)return console.error("Template #settings-logs-row not found"),document.createElement("tr");let n=s.content.cloneNode(!0),r=n.querySelector('[data-role="log-type-icon"]'),l=n.querySelector('[data-role="log-type"]');r&&l&&(t.type==="upload"?(r.className="ri-upload-cloud-2-line text-lg leading-4",l.textContent="Upload"):t.type==="download"&&(r.className="ri-download-cloud-2-line text-lg leading-4",l.textContent="Download"));let c=n.querySelector('[data-role="log-timestamp"]');if(c&&t.timestamp){let e=new Date(t.timestamp);c.textContent=e.toLocaleString(),c.title=t.timestamp}let f=n.querySelector('[data-role="log-duration"]');if(f){let e=t.duration,o;if(e<1e3)o=`${e}ms`;else if(e<6e4)o=`${(e/1e3).toFixed(2)}s`;else{let x=Math.floor(e/6e4),L=Math.floor(e%6e4/1e3);o=`${x}m ${L}s`}f.textContent=o}let i=n.querySelector('[data-role="log-status"]');if(i&&t.statusCode){let e=t.statusCode;i.textContent=e,e>=200&&e<300?i.className="text-xs font-mono font-semibold text-green-600 dark:text-green-400":e>=300&&e<400?i.className="text-xs font-mono font-semibold text-blue-600 dark:text-blue-400":e>=400&&e<500?i.className="text-xs font-mono font-semibold text-orange-600 dark:text-orange-400":e>=500?i.className="text-xs font-mono font-semibold text-red-600 dark:text-red-400":i.className="text-xs font-mono text-grey-60 dark:text-grey-40"}let a=n.querySelector('[data-role="log-file-id"]');if(a&&t.fileId){let e=p.getFileById(t.fileId);if(e&&e.name)a.textContent=e.name,a.title=`File: ${e.name} (ID: ${t.fileId})`;else{let o=t.fileId.substring(0,8)+"\u2026";a.textContent=o,a.title=t.fileId}}let u=n.querySelector('[data-role="log-owner"]');u&&t.ownerName&&(u.textContent=t.ownerName,u.title=`${t.ownerType==="owner"?"Owner":"Guest"}: ${t.ownerName}`);let m=n.querySelector('[data-role="log-ip"]');m&&t.ip&&(m.textContent=t.ip);let d=n.querySelector('[data-role="log-request-data"]');if(d){let e=[];t.userAgent&&e.push(t.userAgent),t.origin&&e.push(`Origin: ${t.origin}`);let o=e.join(" \u2022 ")||"\u2014";d.textContent=o,d.title=o}let h=n.querySelector('[data-role="log-accessed-by"]');return h&&(t.sessionUser&&t.sessionUser!=="Anonymous"?h.textContent=t.sessionUser:h.innerHTML='<span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-grey-20 dark:bg-grey-80 text-grey-70 dark:text-grey-40">[Guest]</span>'),n}_updatePaginationUI(){if(this._countText){let t=(this._currentPage-1)*50+1,s=t+this._currentLogCount-1,n=this._totalCount.toLocaleString();this._currentLogCount>0?this._countText.textContent=`${t}-${s} of ${n}`:this._countText.textContent=`0 of ${n}`}if(this._nextButton){let t=this._totalCount>(this._currentPage-1)*50+this._currentLogCount;this._nextButton.disabled=!t}}};customElements.define("settings-logs-panel",_);
