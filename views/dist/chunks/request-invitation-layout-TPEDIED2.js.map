{
  "version": 3,
  "sources": ["../../src/ui/request-invitation-layout.mjs"],
  "sourcesContent": ["import { translateElement } from \"../utils.mjs\";\n\nclass RequestInvitationLayoutElement extends HTMLElement {\n  constructor() {\n    super();\n    this.form = null;\n    this.emailInput = null;\n    this.messageElement = null;\n    this.submitButton = null;\n\n    this._frame = null;\n    this._templateMounted = false;\n\n    this._boundHandlers = {\n      submit: this.handleSubmit.bind(this),\n    };\n  }\n\n  connectedCallback() {\n    if (!this._templateMounted) {\n      const template = document.getElementById(\"request-invitation-layout\");\n      if (!template) {\n        console.error(\"Template #request-invitation-layout not found\");\n        return;\n      }\n      const content = template.content.cloneNode(true);\n      this.appendChild(content);\n      this._templateMounted = true;\n    }\n\n    if (this._frame !== null) {\n      cancelAnimationFrame(this._frame);\n    }\n\n    this._frame = requestAnimationFrame(() => {\n      this._frame = null;\n      if (!this.isConnected) {\n        return;\n      }\n\n      translateElement(this);\n\n      this.form = this.querySelector('[data-role=\"request-form\"]');\n      this.emailInput = this.querySelector('[data-role=\"email-input\"]');\n      this.messageElement = this.querySelector('[data-role=\"message\"]');\n      this.submitButton = this.querySelector('[data-role=\"submit\"]');\n\n      if (this.form) {\n        this.form.addEventListener(\"submit\", this._boundHandlers.submit);\n      }\n    });\n  }\n\n  disconnectedCallback() {\n    if (this._frame !== null) {\n      cancelAnimationFrame(this._frame);\n      this._frame = null;\n    }\n\n    if (this.form) {\n      this.form.removeEventListener(\"submit\", this._boundHandlers.submit);\n    }\n  }\n\n  async handleSubmit(event) {\n    event.preventDefault();\n    this.hideMessage();\n\n    const email = this.emailInput?.value.trim();\n\n    if (!email || !this.isValidEmail(email)) {\n      const translate = window.translate || ((key) => key);\n      this.showMessage(\n        translate(\"authErrorInvalidEmail\") || \"Please enter a valid email address\",\n        true\n      );\n      return;\n    }\n\n    if (this.submitButton) {\n      this.submitButton.disabled = true;\n      this.setSubmitLabel(\"requestInvitationSubmitting\");\n    }\n\n    // Try up to 3 times with exponential backoff\n    const maxRetries = 3;\n    let lastError = null;\n\n    for (let attempt = 1; attempt <= maxRetries; attempt++) {\n      try {\n        const response = await fetch(\"/api/request-invitation\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({ email }),\n        });\n\n        if (!response.ok) {\n          throw new Error(`Request failed with status ${response.status}`);\n        }\n\n        const result = await response.json();\n\n        // Success! Hide the form fields and show only the success message\n        const translate = window.translate || ((key) => key);\n        this.showMessage(\n          translate(\"requestInvitationSuccess\") ||\n            \"If your email domain is authorized, you will receive an invitation shortly.\",\n          false\n        );\n\n        // Hide the email input and submit button, but keep the message visible\n        if (this.emailInput) {\n          this.emailInput.parentElement.style.display = \"none\"; // Hide the input div\n        }\n        if (this.submitButton) {\n          this.submitButton.style.display = \"none\"; // Hide the submit button\n        }\n\n        return; // Exit successfully\n      } catch (error) {\n        lastError = error;\n        console.error(`[RequestInvitationLayout] Attempt ${attempt}/${maxRetries} failed`, error);\n\n        // If not the last attempt, wait before retrying (exponential backoff)\n        if (attempt < maxRetries) {\n          const delayMs = Math.pow(2, attempt - 1) * 1000; // 1s, 2s\n          await new Promise(resolve => setTimeout(resolve, delayMs));\n        }\n      }\n    }\n\n    // All retries failed, show error message\n    const translate = window.translate || ((key) => key);\n    this.showMessage(\n      translate(\"requestInvitationError\") ||\n        \"Failed to submit request. Please try again later.\",\n      true\n    );\n\n    if (this.submitButton) {\n      this.submitButton.disabled = false;\n      this.setSubmitLabel(\"requestInvitationSubmitButton\");\n    }\n  }\n\n  showMessage(message, isError) {\n    if (this.messageElement) {\n      this.messageElement.textContent = message;\n      this.messageElement.classList.remove(\"hidden\");\n\n      if (isError) {\n        this.messageElement.classList.remove(\"text-green-600\", \"dark:text-green-400\");\n        this.messageElement.classList.add(\"text-red-600\", \"dark:text-red-400\");\n      } else {\n        this.messageElement.classList.remove(\"text-red-600\", \"dark:text-red-400\");\n        this.messageElement.classList.add(\"text-green-600\", \"dark:text-green-400\");\n      }\n    }\n  }\n\n  hideMessage() {\n    if (this.messageElement) {\n      this.messageElement.textContent = \"\";\n      this.messageElement.classList.add(\"hidden\");\n      this.messageElement.classList.remove(\n        \"text-red-600\",\n        \"dark:text-red-400\",\n        \"text-green-600\",\n        \"dark:text-green-400\"\n      );\n    }\n  }\n\n  setSubmitLabel(key) {\n    if (!this.submitButton) {\n      return;\n    }\n    const translate = window.translate || ((key) => key);\n    const label = this.submitButton.querySelector('[data-type=\"lang\"]');\n    const text = translate(key);\n    if (label) {\n      label.textContent = text;\n    } else {\n      this.submitButton.textContent = text;\n    }\n  }\n\n  isValidEmail(email) {\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    return emailRegex.test(email);\n  }\n}\n\ncustomElements.define(\"request-invitation-layout\", RequestInvitationLayoutElement);\n"],
  "mappings": "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",
  "names": ["translate", "key"]
}
