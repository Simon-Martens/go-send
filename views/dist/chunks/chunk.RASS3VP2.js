import{a as ee,b as Nt,e as Oe,f as Ne,j as Me,k as Ce,l as qe,n as Re}from"./chunk.EL6E2633.js";import{a as k,b as et,e as te}from"./chunk.NJSDOF6A.js";var it=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function ct(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function ne(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function Z(e,...t){if(!ct(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function re(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function De(e,t){Z(e);let n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function St(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function Ct(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}var ke=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Mn=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function at(e){if(Z(e),ke)return e.toHex();let t="";for(let n=0;n<e.length;n++)t+=Mn[e[n]];return t}var W={_0:48,_9:57,A:65,F:70,a:97,f:102};function Pe(e){if(e>=W._0&&e<=W._9)return e-W._0;if(e>=W.A&&e<=W.F)return e-(W.A-10);if(e>=W.a&&e<=W.f)return e-(W.a-10)}function qt(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(ke)return Uint8Array.fromHex(e);let t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let r=new Uint8Array(n);for(let o=0,s=0;o<n;o++,s+=2){let i=Pe(e.charCodeAt(s)),a=Pe(e.charCodeAt(s+1));if(i===void 0||a===void 0){let c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[o]=i*16+a}return r}function oe(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function se(e){return typeof e=="string"&&(e=oe(e)),Z(e),e}function xt(...e){let t=0;for(let r=0;r<e.length;r++){let o=e[r];Z(o),t+=o.length}let n=new Uint8Array(t);for(let r=0,o=0;r<e.length;r++){let s=e[r];n.set(s,o),o+=s.length}return n}var Mt=class{};function Fe(e){let t=r=>e().update(se(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function _t(e=32){if(it&&typeof it.getRandomValues=="function")return it.getRandomValues(new Uint8Array(e));if(it&&typeof it.randomBytes=="function")return Uint8Array.from(it.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}function Cn(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),a=Number(n&s),c=r?4:0,u=r?0:4;e.setUint32(t+c,i,r),e.setUint32(t+u,a,r)}var Rt=class extends Mt{constructor(t,n,r,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.buffer=new Uint8Array(t),this.view=Ct(this.buffer)}update(t){re(this),t=se(t),Z(t);let{view:n,buffer:r,blockLen:o}=this,s=t.length;for(let i=0;i<s;){let a=Math.min(o-this.pos,s-i);if(a===o){let c=Ct(t);for(;o<=s-i;i+=o)this.process(c,i);continue}r.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){re(this),De(t,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:s}=this,{pos:i}=this;n[i++]=128,St(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(r,0),i=0);for(let d=i;d<o;d++)n[d]=0;Cn(r,o-8,BigInt(this.length*8),s),this.process(r,0);let a=Ct(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,h=this.get();if(u>h.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<u;d++)a.setUint32(4*d,h[d],s)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:a}=this;return t.destroyed=i,t.finished=s,t.length=o,t.pos=a,o%n&&t.buffer.set(r),t}clone(){return this._cloneInto()}};var q=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var Pt=BigInt(4294967295),Ze=BigInt(32);function qn(e,t=!1){return t?{h:Number(e&Pt),l:Number(e>>Ze&Pt)}:{h:Number(e>>Ze&Pt)|0,l:Number(e&Pt)|0}}function Ve(e,t=!1){let n=e.length,r=new Uint32Array(n),o=new Uint32Array(n);for(let s=0;s<n;s++){let{h:i,l:a}=qn(e[s],t);[r[s],o[s]]=[i,a]}return[r,o]}var ie=(e,t,n)=>e>>>n,ce=(e,t,n)=>e<<32-n|t>>>n,ft=(e,t,n)=>e>>>n|t<<32-n,ut=(e,t,n)=>e<<32-n|t>>>n,At=(e,t,n)=>e<<64-n|t>>>n-32,vt=(e,t,n)=>e>>>n-32|t<<64-n;function z(e,t,n,r){let o=(t>>>0)+(r>>>0);return{h:e+n+(o/2**32|0)|0,l:o|0}}var Ge=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),Xe=(e,t,n,r)=>t+n+r+(e/2**32|0)|0,Ye=(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),ze=(e,t,n,r,o)=>t+n+r+o+(e/2**32|0)|0,We=(e,t,n,r,o)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(o>>>0),je=(e,t,n,r,o,s)=>t+n+r+o+s+(e/2**32|0)|0;var $e=Ve(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),Pn=$e[0],Dn=$e[1],nt=new Uint32Array(80),rt=new Uint32Array(80),ae=class extends Rt{constructor(t=64){super(128,t,16,!1),this.Ah=q[0]|0,this.Al=q[1]|0,this.Bh=q[2]|0,this.Bl=q[3]|0,this.Ch=q[4]|0,this.Cl=q[5]|0,this.Dh=q[6]|0,this.Dl=q[7]|0,this.Eh=q[8]|0,this.El=q[9]|0,this.Fh=q[10]|0,this.Fl=q[11]|0,this.Gh=q[12]|0,this.Gl=q[13]|0,this.Hh=q[14]|0,this.Hl=q[15]|0}get(){let{Ah:t,Al:n,Bh:r,Bl:o,Ch:s,Cl:i,Dh:a,Dl:c,Eh:u,El:h,Fh:d,Fl:f,Gh:y,Gl:p,Hh:b,Hl:g}=this;return[t,n,r,o,s,i,a,c,u,h,d,f,y,p,b,g]}set(t,n,r,o,s,i,a,c,u,h,d,f,y,p,b,g){this.Ah=t|0,this.Al=n|0,this.Bh=r|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=h|0,this.Fh=d|0,this.Fl=f|0,this.Gh=y|0,this.Gl=p|0,this.Hh=b|0,this.Hl=g|0}process(t,n){for(let x=0;x<16;x++,n+=4)nt[x]=t.getUint32(n),rt[x]=t.getUint32(n+=4);for(let x=16;x<80;x++){let A=nt[x-15]|0,I=rt[x-15]|0,H=ft(A,I,1)^ft(A,I,8)^ie(A,I,7),L=ut(A,I,1)^ut(A,I,8)^ce(A,I,7),v=nt[x-2]|0,m=rt[x-2]|0,w=ft(v,m,19)^At(v,m,61)^ie(v,m,6),_=ut(v,m,19)^vt(v,m,61)^ce(v,m,6),T=Ye(L,_,rt[x-7],rt[x-16]),E=ze(T,H,w,nt[x-7],nt[x-16]);nt[x]=E|0,rt[x]=T|0}let{Ah:r,Al:o,Bh:s,Bl:i,Ch:a,Cl:c,Dh:u,Dl:h,Eh:d,El:f,Fh:y,Fl:p,Gh:b,Gl:g,Hh:l,Hl:B}=this;for(let x=0;x<80;x++){let A=ft(d,f,14)^ft(d,f,18)^At(d,f,41),I=ut(d,f,14)^ut(d,f,18)^vt(d,f,41),H=d&y^~d&b,L=f&p^~f&g,v=We(B,I,L,Dn[x],rt[x]),m=je(v,l,A,H,Pn[x],nt[x]),w=v|0,_=ft(r,o,28)^At(r,o,34)^At(r,o,39),T=ut(r,o,28)^vt(r,o,34)^vt(r,o,39),E=r&s^r&a^s&a,S=o&i^o&c^i&c;l=b|0,B=g|0,b=y|0,g=p|0,y=d|0,p=f|0,{h:d,l:f}=z(u|0,h|0,m|0,w|0),u=a|0,h=c|0,a=s|0,c=i|0,s=r|0,i=o|0;let U=Ge(w,T,S);r=Xe(U,m,_,E),o=U|0}({h:r,l:o}=z(this.Ah|0,this.Al|0,r|0,o|0)),{h:s,l:i}=z(this.Bh|0,this.Bl|0,s|0,i|0),{h:a,l:c}=z(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l:h}=z(this.Dh|0,this.Dl|0,u|0,h|0),{h:d,l:f}=z(this.Eh|0,this.El|0,d|0,f|0),{h:y,l:p}=z(this.Fh|0,this.Fl|0,y|0,p|0),{h:b,l:g}=z(this.Gh|0,this.Gl|0,b|0,g|0),{h:l,l:B}=z(this.Hh|0,this.Hl|0,l|0,B|0),this.set(r,o,s,i,a,c,u,h,d,f,y,p,b,g,l,B)}roundClean(){St(nt,rt)}destroy(){St(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var Je=Fe(()=>new ae);var le=BigInt(0),ue=BigInt(1);function Dt(e,t=""){if(typeof e!="boolean"){let n=t&&`"${t}"`;throw new Error(n+"expected boolean, got type="+typeof e)}return e}function It(e,t,n=""){let r=ct(e),o=e==null?void 0:e.length,s=t!==void 0;if(!r||s&&o!==t){let i=n&&`"${n}" `,a=s?` of length ${t}`:"",c=r?`length=${o}`:`type=${typeof e}`;throw new Error(i+"expected Uint8Array"+a+", got "+c)}return e}function Qe(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?le:BigInt("0x"+e)}function tn(e){return Qe(at(e))}function Y(e){return Z(e),Qe(at(Uint8Array.from(e).reverse()))}function he(e,t){return qt(e.toString(16).padStart(t*2,"0"))}function kt(e,t){return he(e,t).reverse()}function P(e,t,n){let r;if(typeof t=="string")try{r=qt(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else if(ct(t))r=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");let o=r.length;if(typeof n=="number"&&o!==n)throw new Error(e+" of length "+n+" expected, got "+o);return r}function en(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}function de(e){return Uint8Array.from(e)}var fe=e=>typeof e=="bigint"&&le<=e;function kn(e,t,n){return fe(e)&&fe(t)&&fe(n)&&t<=e&&e<n}function mt(e,t,n,r){if(!kn(t,n,r))throw new Error("expected valid "+e+": "+n+" <= n < "+r+", got "+t)}function nn(e){let t;for(t=0;e>le;e>>=ue,t+=1);return t}var Tt=e=>(ue<<BigInt(e))-ue;function lt(e,t,n={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function r(o,s,i){let a=e[o];if(i&&a===void 0)return;let c=typeof a;if(c!==s||a===null)throw new Error(`param "${o}" is invalid: expected ${s}, got ${c}`)}Object.entries(t).forEach(([o,s])=>r(o,s,!1)),Object.entries(n).forEach(([o,s])=>r(o,s,!0))}var pe=()=>{throw new Error("not implemented")};function xe(e){let t=new WeakMap;return(n,...r)=>{let o=t.get(n);if(o!==void 0)return o;let s=e(n,...r);return t.set(n,s),s}}var F=BigInt(0),D=BigInt(1),ht=BigInt(2),sn=BigInt(3),cn=BigInt(4),an=BigInt(5),Fn=BigInt(7),fn=BigInt(8),Zn=BigInt(9),un=BigInt(16);function K(e,t){let n=e%t;return n>=F?n:t+n}function G(e,t,n){let r=e;for(;t-- >F;)r*=r,r%=n;return r}function rn(e,t){if(e===F)throw new Error("invert: expected non-zero number");if(t<=F)throw new Error("invert: expected positive modulus, got "+t);let n=K(e,t),r=t,o=F,s=D,i=D,a=F;for(;n!==F;){let u=r/n,h=r%n,d=o-i*u,f=s-a*u;r=n,n=h,o=i,s=a,i=d,a=f}if(r!==D)throw new Error("invert: does not exist");return K(o,t)}function me(e,t,n){if(!e.eql(e.sqr(t),n))throw new Error("Cannot find square root")}function ln(e,t){let n=(e.ORDER+D)/cn,r=e.pow(t,n);return me(e,r,t),r}function Vn(e,t){let n=(e.ORDER-an)/fn,r=e.mul(t,ht),o=e.pow(r,n),s=e.mul(t,o),i=e.mul(e.mul(s,ht),o),a=e.mul(s,e.sub(i,e.ONE));return me(e,a,t),a}function Gn(e){let t=$(e),n=hn(e),r=n(t,t.neg(t.ONE)),o=n(t,r),s=n(t,t.neg(r)),i=(e+Fn)/un;return(a,c)=>{let u=a.pow(c,i),h=a.mul(u,r),d=a.mul(u,o),f=a.mul(u,s),y=a.eql(a.sqr(h),c),p=a.eql(a.sqr(d),c);u=a.cmov(u,h,y),h=a.cmov(f,d,p);let b=a.eql(a.sqr(h),c),g=a.cmov(u,h,b);return me(a,g,c),g}}function hn(e){if(e<sn)throw new Error("sqrt is not defined for small field");let t=e-D,n=0;for(;t%ht===F;)t/=ht,n++;let r=ht,o=$(e);for(;on(o,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return ln;let s=o.pow(r,t),i=(t+D)/ht;return function(c,u){if(c.is0(u))return u;if(on(c,u)!==1)throw new Error("Cannot find square root");let h=n,d=c.mul(c.ONE,s),f=c.pow(u,t),y=c.pow(u,i);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let p=1,b=c.sqr(f);for(;!c.eql(b,c.ONE);)if(p++,b=c.sqr(b),p===h)throw new Error("Cannot find square root");let g=D<<BigInt(h-p-1),l=c.pow(d,g);h=p,d=c.sqr(l),f=c.mul(f,d),y=c.mul(y,l)}return y}}function Xn(e){return e%cn===sn?ln:e%fn===an?Vn:e%un===Zn?Gn(e):hn(e)}var j=(e,t)=>(K(e,t)&D)===D,Yn=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function dn(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=Yn.reduce((r,o)=>(r[o]="function",r),t);return lt(e,n),e}function zn(e,t,n){if(n<F)throw new Error("invalid exponent, negatives unsupported");if(n===F)return e.ONE;if(n===D)return t;let r=e.ONE,o=t;for(;n>F;)n&D&&(r=e.mul(r,o)),o=e.sqr(o),n>>=D;return r}function Ft(e,t,n=!1){let r=new Array(t.length).fill(n?e.ZERO:void 0),o=t.reduce((i,a,c)=>e.is0(a)?i:(r[c]=i,e.mul(i,a)),e.ONE),s=e.inv(o);return t.reduceRight((i,a,c)=>e.is0(a)?i:(r[c]=e.mul(i,r[c]),e.mul(i,a)),s),r}function on(e,t){let n=(e.ORDER-D)/ht,r=e.pow(t,n),o=e.eql(r,e.ONE),s=e.eql(r,e.ZERO),i=e.eql(r,e.neg(e.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function pn(e,t){t!==void 0&&ne(t);let n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function $(e,t,n=!1,r={}){if(e<=F)throw new Error("invalid field: expected ORDER > 0, got "+e);let o,s,i=!1,a;if(typeof t=="object"&&t!=null){if(r.sqrt||n)throw new Error("cannot specify opts in two arguments");let f=t;f.BITS&&(o=f.BITS),f.sqrt&&(s=f.sqrt),typeof f.isLE=="boolean"&&(n=f.isLE),typeof f.modFromBytes=="boolean"&&(i=f.modFromBytes),a=f.allowedLengths}else typeof t=="number"&&(o=t),r.sqrt&&(s=r.sqrt);let{nBitLength:c,nByteLength:u}=pn(e,o);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let h,d=Object.freeze({ORDER:e,isLE:n,BITS:c,BYTES:u,MASK:Tt(c),ZERO:F,ONE:D,allowedLengths:a,create:f=>K(f,e),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return F<=f&&f<e},is0:f=>f===F,isValidNot0:f=>!d.is0(f)&&d.isValid(f),isOdd:f=>(f&D)===D,neg:f=>K(-f,e),eql:(f,y)=>f===y,sqr:f=>K(f*f,e),add:(f,y)=>K(f+y,e),sub:(f,y)=>K(f-y,e),mul:(f,y)=>K(f*y,e),pow:(f,y)=>zn(d,f,y),div:(f,y)=>K(f*rn(y,e),e),sqrN:f=>f*f,addN:(f,y)=>f+y,subN:(f,y)=>f-y,mulN:(f,y)=>f*y,inv:f=>rn(f,e),sqrt:s||(f=>(h||(h=Xn(e)),h(d,f))),toBytes:f=>n?kt(f,u):he(f,u),fromBytes:(f,y=!0)=>{if(a){if(!a.includes(f.length)||f.length>u)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);let b=new Uint8Array(u);b.set(f,n?0:b.length-f.length),f=b}if(f.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+f.length);let p=n?Y(f):tn(f);if(i&&(p=K(p,e)),!y&&!d.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:f=>Ft(d,f),cmov:(f,y,p)=>p?y:f});return Object.freeze(d)}var Zt=BigInt(0),be=BigInt(1);function xn(e,t){let n=t.negate();return e?n:t}function Ut(e,t){let n=Ft(e.Fp,t.map(r=>r.Z));return t.map((r,o)=>e.fromAffine(r.toAffine(n[o])))}function wn(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function ye(e,t){wn(e,t);let n=Math.ceil(t/e)+1,r=2**(e-1),o=2**e,s=Tt(e),i=BigInt(e);return{windows:n,windowSize:r,mask:s,maxNumber:o,shiftBy:i}}function mn(e,t,n){let{windowSize:r,mask:o,maxNumber:s,shiftBy:i}=n,a=Number(e&o),c=e>>i;a>r&&(a-=s,c+=be);let u=t*r,h=u+Math.abs(a)-1,d=a===0,f=a<0,y=t%2!==0;return{nextN:c,offset:h,isZero:d,isNeg:f,isNegF:y,offsetF:u}}function Wn(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((n,r)=>{if(!(n instanceof t))throw new Error("invalid point at index "+r)})}function jn(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((n,r)=>{if(!t.isValid(n))throw new Error("invalid scalar at index "+r)})}var ge=new WeakMap,bn=new WeakMap;function we(e){return bn.get(e)||1}function yn(e){if(e!==Zt)throw new Error("invalid wNAF")}var Vt=class{constructor(t,n){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=n}_unsafeLadder(t,n,r=this.ZERO){let o=t;for(;n>Zt;)n&be&&(r=r.add(o)),o=o.double(),n>>=be;return r}precomputeWindow(t,n){let{windows:r,windowSize:o}=ye(n,this.bits),s=[],i=t,a=i;for(let c=0;c<r;c++){a=i,s.push(a);for(let u=1;u<o;u++)a=a.add(i),s.push(a);i=a.double()}return s}wNAF(t,n,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE,i=ye(t,this.bits);for(let a=0;a<i.windows;a++){let{nextN:c,offset:u,isZero:h,isNeg:d,isNegF:f,offsetF:y}=mn(r,a,i);r=c,h?s=s.add(xn(f,n[y])):o=o.add(xn(d,n[u]))}return yn(r),{p:o,f:s}}wNAFUnsafe(t,n,r,o=this.ZERO){let s=ye(t,this.bits);for(let i=0;i<s.windows&&r!==Zt;i++){let{nextN:a,offset:c,isZero:u,isNeg:h}=mn(r,i,s);if(r=a,!u){let d=n[c];o=o.add(h?d.negate():d)}}return yn(r),o}getPrecomputes(t,n,r){let o=ge.get(n);return o||(o=this.precomputeWindow(n,t),t!==1&&(typeof r=="function"&&(o=r(o)),ge.set(n,o))),o}cached(t,n,r){let o=we(t);return this.wNAF(o,this.getPrecomputes(o,t,r),n)}unsafe(t,n,r,o){let s=we(t);return s===1?this._unsafeLadder(t,n,o):this.wNAFUnsafe(s,this.getPrecomputes(s,t,r),n,o)}createCache(t,n){wn(n,this.bits),bn.set(t,n),ge.delete(t)}hasCache(t){return we(t)!==1}};function Gt(e,t,n,r){Wn(n,e),jn(r,t);let o=n.length,s=r.length;if(o!==s)throw new Error("arrays of points and scalars must have equal length");let i=e.ZERO,a=nn(BigInt(o)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let u=Tt(c),h=new Array(Number(u)+1).fill(i),d=Math.floor((t.BITS-1)/c)*c,f=i;for(let y=d;y>=0;y-=c){h.fill(i);for(let b=0;b<s;b++){let g=r[b],l=Number(g>>BigInt(y)&u);h[l]=h[l].add(n[b])}let p=i;for(let b=h.length-1,g=i;b>0;b--)g=g.add(h[b]),p=p.add(g);if(f=f.add(p),y!==0)for(let b=0;b<c;b++)f=f.double()}return f}function gn(e,t,n){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return dn(t),t}else return $(e,{isLE:n})}function Bn(e,t,n={},r){if(r===void 0&&(r=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(let c of["p","n","h"]){let u=t[c];if(!(typeof u=="bigint"&&u>Zt))throw new Error(`CURVE.${c} must be positive bigint`)}let o=gn(t.p,n.Fp,r),s=gn(t.n,n.Fn,r),a=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(let c of a)if(!o.isValid(t[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:o,Fn:s}}var ot=BigInt(0),N=BigInt(1),Be=BigInt(2),$n=BigInt(8);function Jn(e,t,n,r){let o=e.sqr(n),s=e.sqr(r),i=e.add(e.mul(t.a,o),s),a=e.add(e.ONE,e.mul(t.d,e.mul(o,s)));return e.eql(i,a)}function Qn(e,t={}){let n=Bn("edwards",e,t,t.FpFnLE),{Fp:r,Fn:o}=n,s=n.CURVE,{h:i}=s;lt(t,{},{uvRatio:"function"});let a=Be<<BigInt(o.BYTES*8)-N,c=g=>r.create(g),u=t.uvRatio||((g,l)=>{try{return{isValid:!0,value:r.sqrt(r.div(g,l))}}catch{return{isValid:!1,value:ot}}});if(!Jn(r,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function h(g,l,B=!1){let x=B?N:ot;return mt("coordinate "+g,l,x,a),l}function d(g){if(!(g instanceof p))throw new Error("ExtendedPoint expected")}let f=xe((g,l)=>{let{X:B,Y:x,Z:A}=g,I=g.is0();l==null&&(l=I?$n:r.inv(A));let H=c(B*l),L=c(x*l),v=r.mul(A,l);if(I)return{x:ot,y:N};if(v!==N)throw new Error("invZ was invalid");return{x:H,y:L}}),y=xe(g=>{let{a:l,d:B}=s;if(g.is0())throw new Error("bad point: ZERO");let{X:x,Y:A,Z:I,T:H}=g,L=c(x*x),v=c(A*A),m=c(I*I),w=c(m*m),_=c(L*l),T=c(m*c(_+v)),E=c(w+c(B*c(L*v)));if(T!==E)throw new Error("bad point: equation left != right (1)");let S=c(x*A),U=c(I*H);if(S!==U)throw new Error("bad point: equation left != right (2)");return!0});class p{constructor(l,B,x,A){this.X=h("x",l),this.Y=h("y",B),this.Z=h("z",x,!0),this.T=h("t",A),Object.freeze(this)}static CURVE(){return s}static fromAffine(l){if(l instanceof p)throw new Error("extended point not allowed");let{x:B,y:x}=l||{};return h("x",B),h("y",x),new p(B,x,N,c(B*x))}static fromBytes(l,B=!1){let x=r.BYTES,{a:A,d:I}=s;l=de(It(l,x,"point")),Dt(B,"zip215");let H=de(l),L=l[x-1];H[x-1]=L&-129;let v=Y(H),m=B?a:r.ORDER;mt("point.y",v,ot,m);let w=c(v*v),_=c(w-N),T=c(I*w-A),{isValid:E,value:S}=u(_,T);if(!E)throw new Error("bad point: invalid y coordinate");let U=(S&N)===N,O=(L&128)!==0;if(!B&&S===ot&&O)throw new Error("bad point: x=0 and x_0=1");return O!==U&&(S=c(-S)),p.fromAffine({x:S,y:v})}static fromHex(l,B=!1){return p.fromBytes(P("point",l),B)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(l=8,B=!0){return b.createCache(this,l),B||this.multiply(Be),this}assertValidity(){y(this)}equals(l){d(l);let{X:B,Y:x,Z:A}=this,{X:I,Y:H,Z:L}=l,v=c(B*L),m=c(I*A),w=c(x*L),_=c(H*A);return v===m&&w===_}is0(){return this.equals(p.ZERO)}negate(){return new p(c(-this.X),this.Y,this.Z,c(-this.T))}double(){let{a:l}=s,{X:B,Y:x,Z:A}=this,I=c(B*B),H=c(x*x),L=c(Be*c(A*A)),v=c(l*I),m=B+x,w=c(c(m*m)-I-H),_=v+H,T=_-L,E=v-H,S=c(w*T),U=c(_*E),O=c(w*E),M=c(T*_);return new p(S,U,M,O)}add(l){d(l);let{a:B,d:x}=s,{X:A,Y:I,Z:H,T:L}=this,{X:v,Y:m,Z:w,T:_}=l,T=c(A*v),E=c(I*m),S=c(L*x*_),U=c(H*w),O=c((A+I)*(v+m)-T-E),M=U-S,R=U+S,C=c(E-B*T),V=c(O*M),X=c(R*C),Et=c(O*C),pt=c(M*R);return new p(V,X,pt,Et)}subtract(l){return this.add(l.negate())}multiply(l){if(!o.isValidNot0(l))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:B,f:x}=b.cached(this,l,A=>Ut(p,A));return Ut(p,[B,x])[0]}multiplyUnsafe(l,B=p.ZERO){if(!o.isValid(l))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return l===ot?p.ZERO:this.is0()||l===N?this:b.unsafe(this,l,x=>Ut(p,x),B)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return b.unsafe(this,s.n).is0()}toAffine(l){return f(this,l)}clearCofactor(){return i===N?this:this.multiplyUnsafe(i)}toBytes(){let{x:l,y:B}=this.toAffine(),x=r.toBytes(B);return x[x.length-1]|=l&N?128:0,x}toHex(){return at(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get ex(){return this.X}get ey(){return this.Y}get ez(){return this.Z}get et(){return this.T}static normalizeZ(l){return Ut(p,l)}static msm(l,B){return Gt(p,o,l,B)}_setWindowSize(l){this.precompute(l)}toRawBytes(){return this.toBytes()}}p.BASE=new p(s.Gx,s.Gy,N,c(s.Gx*s.Gy)),p.ZERO=new p(ot,N,N,ot),p.Fp=r,p.Fn=o;let b=new Vt(p,o.BITS);return p.BASE.precompute(8),p}var Xt=class{constructor(t){this.ep=t}static fromBytes(t){pe()}static fromHex(t){pe()}get x(){return this.toAffine().x}get y(){return this.toAffine().y}clearCofactor(){return this}assertValidity(){this.ep.assertValidity()}toAffine(t){return this.ep.toAffine(t)}toHex(){return at(this.toBytes())}toString(){return this.toHex()}isTorsionFree(){return!0}isSmallOrder(){return!1}add(t){return this.assertSame(t),this.init(this.ep.add(t.ep))}subtract(t){return this.assertSame(t),this.init(this.ep.subtract(t.ep))}multiply(t){return this.init(this.ep.multiply(t))}multiplyUnsafe(t){return this.init(this.ep.multiplyUnsafe(t))}double(){return this.init(this.ep.double())}negate(){return this.init(this.ep.negate())}precompute(t,n){return this.init(this.ep.precompute(t,n))}toRawBytes(){return this.toBytes()}};function tr(e,t,n={}){if(typeof t!="function")throw new Error('"hash" function param is required');lt(n,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:r}=n,{BASE:o,Fp:s,Fn:i}=e,a=n.randomBytes||_t,c=n.adjustScalarBytes||(m=>m),u=n.domain||((m,w,_)=>{if(Dt(_,"phflag"),w.length||_)throw new Error("Contexts/pre-hash are not supported");return m});function h(m){return i.create(Y(m))}function d(m){let w=x.secretKey;m=P("private key",m,w);let _=P("hashed private key",t(m),2*w),T=c(_.slice(0,w)),E=_.slice(w,2*w),S=h(T);return{head:T,prefix:E,scalar:S}}function f(m){let{head:w,prefix:_,scalar:T}=d(m),E=o.multiply(T),S=E.toBytes();return{head:w,prefix:_,scalar:T,point:E,pointBytes:S}}function y(m){return f(m).pointBytes}function p(m=Uint8Array.of(),...w){let _=xt(...w);return h(t(u(_,P("context",m),!!r)))}function b(m,w,_={}){m=P("message",m),r&&(m=r(m));let{prefix:T,scalar:E,pointBytes:S}=f(w),U=p(_.context,T,m),O=o.multiply(U).toBytes(),M=p(_.context,O,S,m),R=i.create(U+M*E);if(!i.isValid(R))throw new Error("sign failed: invalid s");let C=xt(O,i.toBytes(R));return It(C,x.signature,"result")}let g={zip215:!0};function l(m,w,_,T=g){let{context:E,zip215:S}=T,U=x.signature;m=P("signature",m,U),w=P("message",w),_=P("publicKey",_,x.publicKey),S!==void 0&&Dt(S,"zip215"),r&&(w=r(w));let O=U/2,M=m.subarray(0,O),R=Y(m.subarray(O,U)),C,V,X;try{C=e.fromBytes(_,S),V=e.fromBytes(M,S),X=o.multiplyUnsafe(R)}catch{return!1}if(!S&&C.isSmallOrder())return!1;let Et=p(E,V.toBytes(),C.toBytes(),w);return V.add(C.multiplyUnsafe(Et)).subtract(X).clearCofactor().is0()}let B=s.BYTES,x={secretKey:B,publicKey:B,signature:2*B,seed:B};function A(m=a(x.seed)){return It(m,x.seed,"seed")}function I(m){let w=v.randomSecretKey(m);return{secretKey:w,publicKey:y(w)}}function H(m){return ct(m)&&m.length===i.BYTES}function L(m,w){try{return!!e.fromBytes(m,w)}catch{return!1}}let v={getExtendedPublicKey:f,randomSecretKey:A,isValidSecretKey:H,isValidPublicKey:L,toMontgomery(m){let{y:w}=e.fromBytes(m),_=x.publicKey,T=_===32;if(!T&&_!==57)throw new Error("only defined for 25519 and 448");let E=T?s.div(N+w,N-w):s.div(w-N,w+N);return s.toBytes(E)},toMontgomerySecret(m){let w=x.secretKey;It(m,w);let _=t(m.subarray(0,w));return c(_).subarray(0,w)},randomPrivateKey:A,precompute(m=8,w=e.BASE){return w.precompute(m,!1)}};return Object.freeze({keygen:I,getPublicKey:y,sign:b,verify:l,utils:v,Point:e,lengths:x})}function er(e){let t={a:e.a,d:e.d,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},n=e.Fp,r=$(t.n,e.nBitLength,!0),o={Fp:n,Fn:r,uvRatio:e.uvRatio},s={randomBytes:e.randomBytes,adjustScalarBytes:e.adjustScalarBytes,domain:e.domain,prehash:e.prehash,mapToCurve:e.mapToCurve};return{CURVE:t,curveOpts:o,hash:e.hash,eddsaOpts:s}}function nr(e,t){let n=t.Point;return Object.assign({},t,{ExtendedPoint:n,CURVE:e,nBitLength:n.Fn.BITS,nByteLength:n.Fn.BYTES})}function En(e){let{CURVE:t,curveOpts:n,hash:r,eddsaOpts:o}=er(e),s=Qn(t,n),i=tr(s,r,o);return nr(e,i)}var Lt=BigInt(0),yt=BigInt(1),Yt=BigInt(2);function rr(e){return lt(e,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...e})}function Sn(e){let t=rr(e),{P:n,type:r,adjustScalarBytes:o,powPminus2:s,randomBytes:i}=t,a=r==="x25519";if(!a&&r!=="x448")throw new Error("invalid type");let c=i||_t,u=a?255:448,h=a?32:56,d=BigInt(a?9:5),f=BigInt(a?121665:39081),y=a?Yt**BigInt(254):Yt**BigInt(447),p=a?BigInt(8)*Yt**BigInt(251)-yt:BigInt(4)*Yt**BigInt(445)-yt,b=y+p+yt,g=E=>K(E,n),l=B(d);function B(E){return kt(g(E),h)}function x(E){let S=P("u coordinate",E,h);return a&&(S[31]&=127),g(Y(S))}function A(E){return Y(o(P("scalar",E,h)))}function I(E,S){let U=v(x(S),A(E));if(U===Lt)throw new Error("invalid private or public key received");return B(U)}function H(E){return I(E,l)}function L(E,S,U){let O=g(E*(S-U));return S=g(S-O),U=g(U+O),{x_2:S,x_3:U}}function v(E,S){mt("u",E,Lt,n),mt("scalar",S,y,b);let U=S,O=E,M=yt,R=Lt,C=E,V=yt,X=Lt;for(let pt=BigInt(u-1);pt>=Lt;pt--){let jt=U>>pt&yt;X^=jt,{x_2:M,x_3:C}=L(X,M,C),{x_2:R,x_3:V}=L(X,R,V),X=jt;let $t=M+R,Jt=g($t*$t),Qt=M-R,Ie=g(Qt*Qt),Te=Jt-Ie,On=C+V,Nn=C-V,Ue=g(Nn*$t),Le=g(On*Qt),He=Ue+Le,Ke=Ue-Le;C=g(He*He),V=g(O*g(Ke*Ke)),M=g(Jt*Ie),R=g(Te*(Jt+g(f*Te)))}({x_2:M,x_3:C}=L(X,M,C)),{x_2:R,x_3:V}=L(X,R,V);let Et=s(R);return g(M*Et)}let m={secretKey:h,publicKey:h,seed:h},w=(E=c(h))=>(Z(E,m.seed),E);function _(E){let S=w(E);return{secretKey:S,publicKey:H(S)}}return{keygen:_,getSharedSecret:(E,S)=>I(E,S),getPublicKey:E=>H(E),scalarMult:I,scalarMultBase:H,utils:{randomSecretKey:w,randomPrivateKey:w},GuBytes:l.slice(),lengths:m}}var or=BigInt(0),Q=BigInt(1),_n=BigInt(2),sr=BigInt(3),ir=BigInt(5),cr=BigInt(8),gt=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Ht={p:gt,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:cr,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function In(e){let t=BigInt(10),n=BigInt(20),r=BigInt(40),o=BigInt(80),s=gt,a=e*e%s*e%s,c=G(a,_n,s)*a%s,u=G(c,Q,s)*e%s,h=G(u,ir,s)*u%s,d=G(h,t,s)*h%s,f=G(d,n,s)*d%s,y=G(f,r,s)*f%s,p=G(y,o,s)*y%s,b=G(p,o,s)*y%s,g=G(b,t,s)*h%s;return{pow_p_5_8:G(g,_n,s)*e%s,b2:a}}function Tn(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}var Ee=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function Ae(e,t){let n=gt,r=K(t*t*t,n),o=K(r*r*t,n),s=In(e*o).pow_p_5_8,i=K(e*r*s,n),a=K(t*i*i,n),c=i,u=K(i*Ee,n),h=a===e,d=a===K(-e,n),f=a===K(-e*Ee,n);return h&&(i=c),(d||f)&&(i=u),j(i,n)&&(i=K(-i,n)),{isValid:h||d,value:i}}var J=$(Ht.p,{isLE:!0}),ar=$(Ht.n,{isLE:!0}),fr={...Ht,Fp:J,hash:Je,adjustScalarBytes:Tn,uvRatio:Ae},dt=En(fr);var st=(()=>{let e=J.ORDER;return Sn({P:e,type:"x25519",powPminus2:t=>{let{pow_p_5_8:n,b2:r}=In(t);return K(G(n,sr,e)*r,e)},adjustScalarBytes:Tn})})();var Se=Ee,ur=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),lr=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),hr=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),dr=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),An=e=>Ae(Q,e),pr=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),_e=e=>dt.Point.Fp.create(Y(e)&pr);function vn(e){let{d:t}=Ht,n=gt,r=l=>J.create(l),o=r(Se*e*e),s=r((o+Q)*hr),i=BigInt(-1),a=r((i-t*o)*r(o+t)),{isValid:c,value:u}=Ae(s,a),h=r(u*e);j(h,n)||(h=r(-h)),c||(u=h),c||(i=o);let d=r(i*(o-Q)*dr-a),f=u*u,y=r((u+u)*a),p=r(d*ur),b=r(Q-f),g=r(Q+f);return new dt.Point(r(y*g),r(b*p),r(p*g),r(y*b))}function xr(e){Z(e,64);let t=_e(e.subarray(0,32)),n=vn(t),r=_e(e.subarray(32,64)),o=vn(r);return new tt(n.add(o))}var tt=class e extends Xt{constructor(t){super(t)}static fromAffine(t){return new e(dt.Point.fromAffine(t))}assertSame(t){if(!(t instanceof e))throw new Error("RistrettoPoint expected")}init(t){return new e(t)}static hashToCurve(t){return xr(P("ristrettoHash",t,64))}static fromBytes(t){Z(t,32);let{a:n,d:r}=Ht,o=gt,s=A=>J.create(A),i=_e(t);if(!en(J.toBytes(i),t)||j(i,o))throw new Error("invalid ristretto255 encoding 1");let a=s(i*i),c=s(Q+n*a),u=s(Q-n*a),h=s(c*c),d=s(u*u),f=s(n*r*h-d),{isValid:y,value:p}=An(s(f*d)),b=s(p*u),g=s(p*b*f),l=s((i+i)*b);j(l,o)&&(l=s(-l));let B=s(c*g),x=s(l*B);if(!y||j(x,o)||B===or)throw new Error("invalid ristretto255 encoding 2");return new e(new dt.Point(l,B,Q,x))}static fromHex(t){return e.fromBytes(P("ristrettoHex",t,32))}static msm(t,n){return Gt(e,dt.Point.Fn,t,n)}toBytes(){let{X:t,Y:n,Z:r,T:o}=this.ep,s=gt,i=g=>J.create(g),a=i(i(r+n)*i(r-n)),c=i(t*n),u=i(c*c),{value:h}=An(i(a*u)),d=i(h*a),f=i(h*c),y=i(d*f*o),p;if(j(o*y,s)){let g=i(n*Se),l=i(t*Se);t=g,n=l,p=i(d*lr)}else p=f;j(t*y,s)&&(n=i(-n));let b=i((r-n)*p);return j(b,s)&&(b=i(-b)),J.toBytes(b)}equals(t){this.assertSame(t);let{X:n,Y:r}=this.ep,{X:o,Y:s}=t.ep,i=u=>J.create(u),a=i(n*s)===i(r*o),c=i(r*s)===i(n*o);return a||c}is0(){return this.equals(e.ZERO)}};tt.BASE=new tt(dt.Point.BASE);tt.ZERO=new tt(dt.Point.ZERO);tt.Fp=J;tt.Fn=ar;var zt=1,mr="1.0.0",fo={ADMIN:0,USER:1,GUEST:2},yr="user_state",Hn=12,gr=new TextEncoder,Kn=gr.encode("go-send-owner-wrap-v1");function Un(){let e=new Uint8Array(32);return crypto.getRandomValues(e),e[0]&=248,e[31]&=127,e[31]|=64,e}function wr(e){return e instanceof ArrayBuffer?e.slice(0):e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}async function Ln(e,t){let n=await crypto.subtle.importKey("raw",e,"HKDF",!1,["deriveKey"]),r=await crypto.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:new Uint8Array,info:Kn},n,{name:"AES-GCM",length:256},!1,["encrypt"]),o=crypto.getRandomValues(new Uint8Array(Hn)),s=await crypto.subtle.encrypt({name:"AES-GCM",iv:o},r,wr(t));return{ciphertext:new Uint8Array(s),nonce:o}}function bt(){return yr}var wt=class e{constructor({email:t,name:n,role:r,settings:o,salt:s,x25519PrivateKey:i,x25519PublicKey:a,version:c}={}){this.email=t||null,this.name=n||null,this.role=r??null,this.settings=o||null,this.salt=s||null,this.x25519PrivateKey=i||null,this.x25519PublicKey=a||null,this.version=c||null}static fromKeyMaterial({email:t,name:n,role:r,settings:o,salt:s,x25519Seed:i,x25519PublicKey:a,version:c}){if(!t)throw new Error("email required to persist user secrets");if(!s)throw new Error("salt required to persist user secrets");if(!(i instanceof Uint8Array)||i.length===0)throw new Error("invalid X25519 key material");let u=k(i),h=k(st.scalarMultBase(i));return new e({email:t,name:n,role:r,settings:o,salt:s,x25519PrivateKey:u,x25519PublicKey:a?k(a):h,version:c||mr})}toJSON(){return{email:this.email,name:this.name,role:this.role,settings:this.settings,salt:this.salt,x25519PrivateKey:this.x25519PrivateKey,x25519PublicKey:this.x25519PublicKey,version:this.version}}getX25519PrivateKey(){return this.x25519PrivateKey?et(this.x25519PrivateKey):null}getX25519PublicKey(){return this.x25519PublicKey?et(this.x25519PublicKey):null}getSaltBytes(){return this.salt?et(this.salt):null}async wrapSecret(t){if(!(t instanceof Uint8Array))throw new TypeError("secretBytes must be a Uint8Array");if(!t.length)throw new Error("secretBytes cannot be empty");let n=!1,r=this.getX25519PublicKey();if(!r){let u=this.getX25519PrivateKey();if(!u)throw new Error("missing X25519 key material");r=st.scalarMultBase(u),u.fill(0),this.x25519PublicKey=k(r),n=!0}let o=Un(),s=st.scalarMultBase(o),i=st.scalarMult(o,r),{ciphertext:a,nonce:c}=await Ln(i,t);return o.fill(0),i.fill(0),{ciphertext:k(a),nonce:k(c),ephemeralPublicKey:k(s),version:zt,updated:n}}async unwrapSecret({ciphertext:t,nonce:n,ephemeralPublicKey:r,version:o=zt}){if(o!==zt)throw new Error(`Unsupported secret version: ${o}`);let s=this.getX25519PrivateKey();if(!s)throw new Error("missing X25519 private key");let i=et(t),a=et(n),c=et(r);if(a.length!==Hn)throw new Error("invalid nonce length");if(c.length!==32)throw new Error("invalid ephemeral public key");let u=st.scalarMult(s,c);s.fill(0);let h=await crypto.subtle.importKey("raw",u,"HKDF",!1,["deriveKey"]),d=await crypto.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:new Uint8Array,info:Kn},h,{name:"AES-GCM",length:256},!1,["decrypt"]);u.fill(0);let f=await crypto.subtle.decrypt({name:"AES-GCM",iv:a},d,i);return new Uint8Array(f)}static async wrapSecretForRecipient(t,n){if(!(t instanceof Uint8Array))throw new TypeError("secretBytes must be a Uint8Array");if(!t.length)throw new Error("secretBytes cannot be empty");if(!n)throw new Error("recipientPublicKeyB64 is required");let r=et(n);if(r.length!==32)throw new Error("invalid recipient public key length");let o=Un(),s=st.scalarMultBase(o),i=st.scalarMult(o,r),{ciphertext:a,nonce:c}=await Ln(i,t);return o.fill(0),i.fill(0),{ciphertext:k(a),nonce:k(c),ephemeralPublicKey:k(s),version:zt}}};var Kt=new TextEncoder,br=new TextDecoder,Ot=class{constructor(t,n){this._nonce=n||"yRCdyQ1EMSA3mo4rqSkuNQ==",t?this.rawSecret=Nt(t):this.rawSecret=crypto.getRandomValues(new Uint8Array(16)),this.secretKeyPromise=crypto.subtle.importKey("raw",this.rawSecret,"HKDF",!1,["deriveKey"]),this.metaKeyPromise=this.secretKeyPromise.then(function(r){return crypto.subtle.deriveKey({name:"HKDF",salt:new Uint8Array,info:Kt.encode("metadata"),hash:"SHA-256"},r,{name:"AES-GCM",length:128},!1,["encrypt","decrypt"])}),this.authKeyPromise=this.secretKeyPromise.then(function(r){return crypto.subtle.deriveKey({name:"HKDF",salt:new Uint8Array,info:Kt.encode("authentication"),hash:"SHA-256"},r,{name:"HMAC",hash:{name:"SHA-256"}},!0,["sign"])})}get nonce(){return this._nonce}set nonce(t){t&&t!==this._nonce&&(this._nonce=t)}setPassword(t,n){this.authKeyPromise=crypto.subtle.importKey("raw",Kt.encode(t),{name:"PBKDF2"},!1,["deriveKey"]).then(r=>crypto.subtle.deriveKey({name:"PBKDF2",salt:Kt.encode(n),iterations:100,hash:"SHA-256"},r,{name:"HMAC",hash:"SHA-256"},!0,["sign"]))}setAuthKey(t){this.authKeyPromise=crypto.subtle.importKey("raw",Nt(t),{name:"HMAC",hash:"SHA-256"},!0,["sign"])}async authKeyB64(){let t=await this.authKeyPromise,n=await crypto.subtle.exportKey("raw",t);return ee(new Uint8Array(n))}async authHeader(){let t=await this.authKeyPromise,n=await crypto.subtle.sign({name:"HMAC"},t,Nt(this.nonce));return`send-v1 ${ee(new Uint8Array(n))}`}async encryptMetadata(t){let n=await this.metaKeyPromise;return await crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(12),tagLength:128},n,Kt.encode(JSON.stringify({name:t.name,size:t.size,type:t.type||"application/octet-stream",manifest:t.manifest||{}})))}encryptStream(t){return Oe(t,this.rawSecret)}decryptStream(t){return Ne(t,this.rawSecret)}async decryptMetadata(t){let n=await this.metaKeyPromise,r=await crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(12),tagLength:128},n,t);return JSON.parse(br.decode(r))}};var Bt=class{constructor(t){if(!t.manifest)throw new Error("invalid file object");this.id=t.id,this.url=t.url,this.name=t.name,this.size=t.size,this.manifest=t.manifest,this.time=t.time,this.speed=t.speed,this.createdAt=t.createdAt,this.expiresAt=t.expiresAt,this.ownerToken=t.ownerToken,this.dlimit=t.dlimit||1,this.dtotal=t.dtotal||0,this.keychain=new Ot(t.secretKey,t.nonce),this._hasPassword=!!t.hasPassword,this.timeLimit=t.timeLimit,this.ownerString=t.ownerString||"",this.authString=t.authString||"",this.recipients=t.recipients||[]}get hasPassword(){return!!this._hasPassword}get expired(){return this.dlimit===this.dtotal||Date.now()>this.expiresAt}async setPassword(t){try{return this.password=t,this._hasPassword=!0,this.keychain.setPassword(t,this.url),await Re(this.id,this.ownerToken,this.keychain)}catch(n){throw this.password=null,this._hasPassword=!1,n}}del(){return Me(this.id,this.ownerToken)}changeLimit(t){return this.dlimit!==t?(this.dlimit=t,Ce(this.id,this.ownerToken,{dlimit:t})):Promise.resolve(!0)}async updateDownloadCount(){let t=this.dtotal,n=this.dlimit;try{let r=await qe(this.id,this.ownerToken);this.dtotal=r.dtotal,this.dlimit=r.dlimit}catch(r){r.message==="404"&&(this.dtotal=this.dlimit)}return t!==this.dtotal||n!==this.dlimit}toJSON(){return{id:this.id,url:this.url,name:this.name,size:this.size,manifest:this.manifest,time:this.time,speed:this.speed,createdAt:this.createdAt,expiresAt:this.expiresAt,secretKey:k(this.keychain.rawSecret),ownerToken:this.ownerToken,dlimit:this.dlimit,dtotal:this.dtotal,hasPassword:this.hasPassword,timeLimit:this.timeLimit,ownerString:this.ownerString,authString:this.authString,recipients:this.recipients}}};var Wt=class{constructor(){this.items=new Map}get length(){return this.items.size}getItem(t){return this.items.get(t)}setItem(t,n){return this.items.set(t,n)}removeItem(t){return this.items.delete(t)}key(t){return this.items.keys()[t]}},ve=class{constructor(){this._trustStorage=null;try{this._trustStorage=localStorage}catch{}let t=this.getTrustPreference();try{this.engine=t?localStorage:sessionStorage,this.engine||(this.engine=new Wt)}catch{this.engine=new Wt}this._files=this.loadFiles(),this._user=this.loadUser()}loadFiles(){let t=new Map;for(let n=0;n<this.engine.length;n++){let r=this.engine.key(n);if(r!==bt()&&te(r))try{let o=new Bt(JSON.parse(this.engine.getItem(r)));o.id||(o.id=o.fileId),t.set(o.id,o)}catch{this.engine.removeItem(r)}}return t}loadUser(){try{let t=this.engine.getItem(bt());return t?new wt(JSON.parse(t)):null}catch{return this.engine.removeItem(bt()),null}}get id(){let t=this.engine.getItem("device_id");return t||(t=k(crypto.getRandomValues(new Uint8Array(16))),this.engine.setItem("device_id",t)),t}get totalDownloads(){return Number(this.engine.getItem("totalDownloads"))}set totalDownloads(t){this.engine.setItem("totalDownloads",t)}get totalUploads(){return Number(this.engine.getItem("totalUploads"))}set totalUploads(t){this.engine.setItem("totalUploads",t)}get referrer(){return this.engine.getItem("referrer")}set referrer(t){this.engine.setItem("referrer",t)}get enrolled(){return JSON.parse(this.engine.getItem("ab_experiments")||"{}")}enroll(t,n){let r={};r[t]=n,this.engine.setItem("ab_experiments",JSON.stringify(r))}get files(){return Array.from(this._files.values()).sort((t,n)=>t.createdAt-n.createdAt)}getFileById(t){return this._files.get(t)}get user(){return this._user}get(t){return this.engine.getItem(t)}set(t,n){return this.engine.setItem(t,n)}remove(t){te(t)&&this._files.delete(t),this.engine.removeItem(t)}addFile(t){this._files.set(t.id,t),this.writeFile(t)}writeFile(t){this.engine.setItem(t.id,JSON.stringify(t))}setUser(t){if(!(t instanceof wt))throw new Error("Expected UserSecrets instance");this._user=t,this.engine.setItem(bt(),JSON.stringify(t.toJSON()))}clearUser(){this._user=null,this.engine.removeItem(bt())}writeFiles(){this._files.forEach(t=>this.writeFile(t))}clearLocalFiles(){this._files.forEach(t=>this.engine.removeItem(t.id)),this._files=new Map}clearAll(){if(this._files=new Map,this._user=null,this.engine.clear)this.engine.clear();else{let t=[];for(let n=0;n<this.engine.length;n++)t.push(this.engine.key(n));t.forEach(n=>this.engine.removeItem(n))}}async merge(t=[]){let n=!1,r=!1,o=!1;for(let i of t)this.getFileById(i.id)||(this.addFile(new Bt(i)),n=!0);let s=this.files.slice();for(let i of s){let a=await i.updateDownloadCount();a&&await this.writeFile(i),o=o||a,r=r||i.expired,i.expired?this.remove(i.id):t.find(c=>c.id===i.id)||(r=!0)}return{incoming:n,outgoing:r,downloadCount:o}}getTrustPreference(){if(!this._trustStorage)return!1;try{let t=this._trustStorage.getItem("trust_this_computer");return t===null?!0:t==="true"}catch{return!1}}setTrustPreference(t){if(this._trustStorage)try{this._trustStorage.setItem("trust_this_computer",t?"true":"false")}catch(n){console.warn("[Storage] Failed to persist trust preference",n)}}switchStorageEngine(t){this.setTrustPreference(t);let n;try{if(n=t?localStorage:sessionStorage,!n){console.warn("[Storage] Requested storage engine unavailable");return}}catch(r){console.warn("[Storage] Failed to access storage engine",r);return}if(!t&&this.engine===localStorage)try{for(let r=0;r<localStorage.length;r++){let o=localStorage.key(r);if(o==="trust_this_computer")continue;let s=localStorage.getItem(o);sessionStorage.setItem(o,s)}}catch(r){console.warn("[Storage] Failed to migrate data to sessionStorage",r)}if(t&&this.engine===sessionStorage)try{for(let r=0;r<sessionStorage.length;r++){let o=sessionStorage.key(r),s=sessionStorage.getItem(o);localStorage.setItem(o,s)}}catch(r){console.warn("[Storage] Failed to migrate data to localStorage",r)}this.engine=n,this._files=this.loadFiles(),this._user=this.loadUser()}},Eo=new ve;export{Ot as a,Bt as b,Je as c,st as d,zt as e,mr as f,fo as g,wt as h,Eo as i};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/edwards.js:
@noble/curves/esm/abstract/montgomery.js:
@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
